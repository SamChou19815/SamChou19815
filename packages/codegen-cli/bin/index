#!/usr/bin/env node
module.exports=(()=>{"use strict";var e={652:(e,n,t)=>{t.r(n);const r=require("fs");const o=require("path");const a=(e,n={})=>({type:"use-action",actionName:e,actionArguments:n});const s=(e,n)=>({type:"run",stepName:e,command:n});const i=e=>{switch(e.type){case"use-action":{const n=`${" ".repeat(6)}- uses: ${e.actionName}\n`;if(Object.keys(e.actionArguments).length===0){return n}const t=Object.entries(e.actionArguments).map(([e,n])=>`${" ".repeat(10)}${e}: "${n}"`).join("\n");return`${n}${" ".repeat(8)}with:\n${t}\n`}case"run":{return`${" ".repeat(6)}- name: ${e.stepName}\n${" ".repeat(8)}run: ${e.command}\n`}}};const c=([e,n])=>{return`  ${e}:\n    runs-on: ubuntu-latest\n    steps:\n${n.map(i).join("")}`};const u=e=>{if(e==null){return`on:\n  push:\n    branches:\n      - master\n  pull_request:`}return`on:\n  push:\n    paths:\n${e.map(e=>`${" ".repeat(6)}- '${e}'`).join("\n")}\n    branches:\n      - master`};const l=e=>{const n=`# @${"generated"}\n\nname: ${e.workflowName}\n${u(e.workflowMasterBranchOnlyTriggerPaths)}\n\njobs:\n${e.workflowJobs.map(c).join("")}`;return n};const p=e=>e!=null;function assertNotNull(e){if(e==null){throw new Error(`Value is asserted to be not null, but it is ${e}.`)}}const d=e=>{assertNotNull(e);return e};const f=[a("actions/checkout@v2",{"fetch-depth":"2"}),a("actions/setup-node@v2-beta"),a("actions/cache@v2",{path:".yarn/cache\\n.pnp.js",key:"yarn-berry-${{ hashFiles('**/yarn.lock') }}","restore-keys":"yarn-berry-"}),s("Yarn Install","yarn install --immutable")];const y=(e,n,t)=>{var a,s;return((s=(a=JSON.parse((0,r.readFileSync)((0,o.join)(d(e.information[n]).workspaceLocation,"package.json")).toString()))===null||a===void 0?void 0:a.scripts)===null||s===void 0?void 0:s[t])!=null};const m={name:"GitHub Actions Workflows Codegen",run:()=>{const e=JSON.parse((0,r.readFileSync)("workspaces.json").toString());return[{outputFilename:".github/workflows/generated-general.yml",outputContent:l({workflowName:"General",workflowJobs:[["lint",[...f,s("Format Check","yarn format:check"),s("Lint","yarn lint")]],["build",[...f,s("Build","yarn compile")]],["validate",[...f,s("Check Codegen","yarn codegen"),s("Check changed","if [[ `git status --porcelain` ]]; then exit 1; fi")]],["test",[...f,s("Test","yarn test")]]]})},...e.topologicallyOrdered.filter(n=>y(e,n,"deploy")).map(n=>{var t,r;const o=`cd-${n}`;return{outputFilename:`.github/workflows/generated-${o}.yml`,outputContent:l({workflowName:`CD ${n}`,workflowMasterBranchOnlyTriggerPaths:[...((r=(t=e.information[n])===null||t===void 0?void 0:t.dependencyChain)!==null&&r!==void 0?r:[]).map(n=>{var t;return`${(t=e.information[n])===null||t===void 0?void 0:t.workspaceLocation}/**`}),"configuration/**",`.github/workflows/generated-*-${n}.yml`],workflowJobs:[["deploy",[...f,s("Build",`yarn workspace ${n} build`),s("Install firebase","sudo npm install -g firebase-tools"),s("Deploy",`FIREBASE_TOKEN=\${{ secrets.FIREBASE_TOKEN }} yarn workspace ${n} deploy`)]]]})}})]}};const w=m;const h=[w];var k=undefined&&undefined.__awaiter||function(e,n,t,r){function adopt(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(t,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?t(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,n||[])).next())})};const b=(0,o.join)(".github","workflows");const g=()=>k(void 0,void 0,void 0,function*(){try{if(!(0,r.existsSync)(b)){(0,r.readdirSync)(b).forEach(e=>{if(e.startsWith("generated-")){(0,r.unlinkSync)((0,o.join)(b,e))}})}(0,r.mkdirSync)(b,{recursive:true});h.forEach(({run:e})=>{e("workspaces.json",(0,r.readFileSync)("workspaces.json").toString()).forEach(({outputFilename:e,outputContent:n})=>{(0,r.writeFileSync)(e,n)})})}catch(e){console.error(e);process.exit(1)}});g()}};var n={};function __webpack_require__(t){if(n[t]){return n[t].exports}var r=n[t]={exports:{}};var o=true;try{e[t](r,r.exports,__webpack_require__);o=false}finally{if(o)delete n[t]}return r.exports}(()=>{__webpack_require__.r=(e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})})})();__webpack_require__.ab=__dirname+"/";return __webpack_require__(652)})();