#!/usr/bin/env node
module.exports=(()=>{"use strict";var e={140:(e,n,t)=>{t.r(n);var r=t(747);var o=t(129);var i=t(282);var c=t.n(i);var s=t(622);var a=t(605);var u=undefined&&undefined.__awaiter||function(e,n,t,r){function adopt(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(t,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?t(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,n||[])).next())})};const d=e=>{const n=[];const t=[];e.trim().split("\n").forEach(e=>{const r=e.trim().split(/\s/).filter(e=>e.trim().length>0);if(r.length===0){return}const o=r[0];if(o==="A"||o==="M"){n.push(r[1])}else if(o==="D"){t.push(r[1])}else if(o.startsWith("R")){t.push(r[1]);n.push(r[2])}});return{changedFiles:n,deletedFiles:t}};const l=e=>new Promise((n,t)=>{a.get(e,e=>{let r="";e.on("data",e=>{r+=e});e.on("end",()=>{try{n(JSON.parse(r))}catch(e){t(e)}})}).on("error",e=>{t(e)})});const f=(e,n=".")=>u(void 0,void 0,void 0,function*(){const t=yield l(`http://localhost:19815/?since=${e}&pathPrefix=${n}`);const r=[];const o=[];t.forEach(({type:e,filename:n})=>{if(e==="changed"){r.push(n)}else{o.push(n)}});return{changedFiles:r,deletedFiles:o}});const p=(e,n=".")=>u(void 0,void 0,void 0,function*(){const t=(e,t)=>{const r=(0,o.spawnSync)("git",["diff",e,...t?[t]:[],"--name-status","--diff-filter=ADRM","--",n]).stdout.toString();return d(r)};if(process.env.CI){return t("HEAD^","HEAD")}try{return yield f(e,n)}catch(e){return t("origin/master")}});const _=p;const v=()=>{let e=process.cwd();while(e!=="/"){const n=(0,s.join)(e,"package.json");if((0,r.existsSync)(n)&&(0,r.lstatSync)(n).isFile()){const t=JSON.parse((0,r.readFileSync)(n).toString());if(Array.isArray(t.workspaces)){return e}}e=(0,s.dirname)(e)}throw new Error("No root package.json found. Abort!")};const h=()=>{try{process.chdir(v())}catch(e){console.error(e.message);process.exit(1)}};var y=undefined&&undefined.__awaiter||function(e,n,t,r){function adopt(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(t,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?t(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,n||[])).next())})};const w=e=>y(void 0,void 0,void 0,function*(){const n=(0,r.existsSync)(e.lastestKnownGoodRunTimeFilename)?JSON.parse((0,r.readFileSync)(e.lastestKnownGoodRunTimeFilename).toString()):{};const t=yield e.needRerun(n);const o=yield Promise.all(t.map(t=>y(void 0,void 0,void 0,function*(){return[t,yield e.rerun(t,n)]})));const i=(new Date).getTime();const c=[];o.forEach(([e,t])=>{if(t){n[e]=i}else{c.push(e)}});(0,r.mkdirSync)((0,s.dirname)(e.lastestKnownGoodRunTimeFilename),{recursive:true});(0,r.writeFileSync)(e.lastestKnownGoodRunTimeFilename,JSON.stringify(n,undefined,2));return c});const m=w;var g=undefined&&undefined.__awaiter||function(e,n,t,r){function adopt(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(t,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?t(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,n||[])).next())})};const S={fileExists:e=>(0,r.existsSync)(e),readFile:e=>(0,r.readFileSync)(e).toString(),writeFile:(e,n)=>{(0,r.mkdirSync)((0,s.dirname)(e),{recursive:true});(0,r.writeFileSync)(e,n)},deleteFile:e=>(0,r.unlinkSync)(e)};const x=".codegen/mappings.json";const j=(e,n,t,r,o=false)=>{const i=e=>{if(o)console.log(e)};i("-------------------- sam-codegen --------------------");const c=r.fileExists(x)?JSON.parse(r.readFile(x)).mappings:{};const s=new Set(e);const a={};Object.entries(c).forEach(([e,n])=>n.forEach(n=>{a[n]=e}));const u=e=>{const n=a[e];if(n!=null)s.add(n)};e.forEach(u);n.forEach(u);const d=new Set;n.forEach(e=>{var n;((n=c[e])!==null&&n!==void 0?n:[]).forEach(e=>{if(r.fileExists(e)){r.deleteFile(e);d.add(e)}});delete c[e]});if(d.size>0){const e=Array.from(d).sort((e,n)=>e.localeCompare(n));i(`[✓] Deleted orphan generated files: [${e.join(", ")}]...`)}else{i("[✓] No orphan generated files.")}const l=new Set;const f=(e,n)=>e.localeCompare(n);t.forEach(({name:e,sourceFileIsRelevant:n,run:t})=>{const o=(e,n)=>{const o=t(e,n);const i=new Set;o.forEach(({outputFilename:e,outputContent:n})=>{r.writeFile(e,n);l.add(e);i.add(e)});c[e]=Array.from(i).sort(f)};i(`> Running ${e}...`);if(n==null){o(`__SYNTHETIC_CODEGEN__${e}__`,"")}else{s.forEach(e=>{if(n(e)){o(e,r.readFile(e))}})}});r.writeFile(x,JSON.stringify({__type__:"@"+"generated",mappings:Object.fromEntries(Object.entries(c).sort(([e],[n])=>f(e,n)))},undefined,2));const p=Array.from(l).sort(f);if(p.length===0){i("[✓] No generated code updates.")}else{i(`[✓] Updated generated files:\n${p.map(e=>`- ${e}`).join("\n")}`)}return p};const E=(e,n=false)=>g(void 0,void 0,void 0,function*(){yield m({lastestKnownGoodRunTimeFilename:(0,s.join)(v(),".codegen","cache.json"),needRerun:()=>g(void 0,void 0,void 0,function*(){return["codegen"]}),rerun:(t,r)=>g(void 0,void 0,void 0,function*(){var t;const o=(t=r["codegen"])!==null&&t!==void 0?t:0;const{changedFiles:i,deletedFiles:c}=yield _(o);j(i,c,e,S,n);return true})})});var b=undefined&&undefined.__awaiter||function(e,n,t,r){function adopt(e){return e instanceof t?e:new t(function(n){n(e)})}return new(t||(t=Promise))(function(t,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?t(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,n||[])).next())})};const F=()=>b(void 0,void 0,void 0,function*(){const e=process.argv[2];if(e==null)throw new Error("No codegen service module path provided!");h();const n=c().createRequire((0,s.join)(v(),"package.json"));const t=n(e);yield E(t,true)});const q=()=>b(void 0,void 0,void 0,function*(){try{yield F()}catch(e){console.error(e);process.exit(1)}});q()},129:e=>{e.exports=require("child_process")},747:e=>{e.exports=require("fs")},605:e=>{e.exports=require("http")},282:e=>{e.exports=require("module")},622:e=>{e.exports=require("path")}};var n={};function __webpack_require__(t){if(n[t]){return n[t].exports}var r=n[t]={exports:{}};var o=true;try{e[t](r,r.exports,__webpack_require__);o=false}finally{if(o)delete n[t]}return r.exports}(()=>{__webpack_require__.n=(e=>{var n=e&&e.__esModule?()=>e["default"]:()=>e;__webpack_require__.d(n,{a:n});return n})})();(()=>{__webpack_require__.d=((e,n)=>{for(var t in n){if(__webpack_require__.o(n,t)&&!__webpack_require__.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:n[t]})}}})})();(()=>{__webpack_require__.o=((e,n)=>Object.prototype.hasOwnProperty.call(e,n))})();(()=>{__webpack_require__.r=(e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})})})();__webpack_require__.ab=__dirname+"/";return __webpack_require__(140)})();