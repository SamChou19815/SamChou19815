#!/usr/bin/env node
module.exports=(()=>{"use strict";var e={140:(e,t,n)=>{n.r(t);var r=n(747);var o=n(129);var i=n(282);var c=n.n(i);var s=n(622);var u=n(605);var a=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})};const d=e=>{const t=[];const n=[];e.trim().split("\n").forEach(e=>{const r=e.trim().split(/\s/).filter(e=>e.trim().length>0);if(r.length===0){return}const o=r[0];if(o==="A"||o==="M"){t.push(r[1])}else if(o==="D"){n.push(r[1])}else if(o.startsWith("R")){n.push(r[1]);t.push(r[2])}});return{changedFiles:t,deletedFiles:n}};const l=e=>new Promise((t,n)=>{u.get(e,e=>{let r="";e.on("data",e=>{r+=e});e.on("end",()=>{try{t(JSON.parse(r))}catch(e){n(e)}})}).on("error",e=>{n(e)})});const f=(e,t=".")=>a(void 0,void 0,void 0,function*(){const n=yield l(`http://localhost:19815/?since=${e}&pathPrefix=${t}`);const r=[];const o=[];n.forEach(({type:e,filename:t})=>{if(e==="changed"){r.push(t)}else{o.push(t)}});return{changedFiles:r,deletedFiles:o}});const p=(e,t=".")=>a(void 0,void 0,void 0,function*(){const n=(e,n)=>{const r=(0,o.spawnSync)("git",["diff",e,...n?[n]:[],"--name-status","--diff-filter=ADRM","--",t]).stdout.toString();return d(r)};if(process.env.CI){return n("HEAD^","HEAD")}try{return yield f(e,t)}catch(e){return n("origin/master")}});const _=p;const v=()=>{let e=process.cwd();while(e!=="/"){const t=(0,s.join)(e,"package.json");if((0,r.existsSync)(t)&&(0,r.lstatSync)(t).isFile()){const n=JSON.parse((0,r.readFileSync)(t).toString());if(Array.isArray(n.workspaces)){return e}}e=(0,s.dirname)(e)}throw new Error("No root package.json found. Abort!")};const y=()=>{try{process.chdir(v())}catch(e){console.error(e.message);process.exit(1)}};var h=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})};const w=e=>h(void 0,void 0,void 0,function*(){const t=(0,r.existsSync)(e.lastestKnownGoodRunTimeFilename)?JSON.parse((0,r.readFileSync)(e.lastestKnownGoodRunTimeFilename).toString()):{};const n=yield e.needRerun(t);const o=yield Promise.all(n.map(n=>h(void 0,void 0,void 0,function*(){return[n,yield e.rerun(n,t)]})));const i=(new Date).getTime();const c=[];o.forEach(([e,n])=>{if(n){t[e]=i}else{c.push(e)}});(0,r.mkdirSync)((0,s.dirname)(e.lastestKnownGoodRunTimeFilename),{recursive:true});(0,r.writeFileSync)(e.lastestKnownGoodRunTimeFilename,JSON.stringify(t,undefined,2));return c});const m=w;var g=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})};const S={fileExists:e=>(0,r.existsSync)(e),readFile:e=>(0,r.readFileSync)(e).toString(),writeFile:(e,t)=>{(0,r.mkdirSync)((0,s.dirname)(e),{recursive:true});(0,r.writeFileSync)(e,t)},deleteFile:e=>(0,r.unlinkSync)(e)};const x=".codegen/mappings.json";const b=(e,t,n,r)=>{const o=r.fileExists(x)?JSON.parse(r.readFile(x)).mappings:{};t.forEach(e=>{var t;((t=o[e])!==null&&t!==void 0?t:[]).forEach(e=>{if(r.fileExists(e)){r.deleteFile(e)}});delete o[e]});const i=new Set;const c=(e,t)=>e.localeCompare(t);e.forEach(e=>{n.forEach(t=>{if(!t.sourceFileIsRelevant(e)){return}const n=r.readFile(e);const s=t.run(e,n);const u=new Set;s.forEach(({outputFilename:e,outputContent:t})=>{r.writeFile(e,t);i.add(e);u.add(e)});o[e]=Array.from(u).sort(c)})});r.writeFile(x,JSON.stringify({__type__:"@"+"generated",mappings:Object.fromEntries(Object.entries(o).sort(([e],[t])=>c(e,t)))},undefined,2));return Array.from(i).sort(c)};const j=e=>g(void 0,void 0,void 0,function*(){yield m({lastestKnownGoodRunTimeFilename:(0,s.join)(v(),".codegen","cache.json"),needRerun:()=>g(void 0,void 0,void 0,function*(){return["codegen"]}),rerun:(t,n)=>g(void 0,void 0,void 0,function*(){var t;const r=(t=n["codegen"])!==null&&t!==void 0?t:0;const{changedFiles:o,deletedFiles:i}=yield _(r);b(o,i,e,S);return true})})});var F=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})};const q=()=>F(void 0,void 0,void 0,function*(){const e=process.argv[2];if(e==null)throw new Error("No codegen service module path provided!");y();const t=c().createRequire((0,s.join)(v(),"package.json"));const n=t(e);yield j(n)});const k=()=>F(void 0,void 0,void 0,function*(){try{yield q()}catch(e){console.error(e);process.exit(1)}});k()},129:e=>{e.exports=require("child_process")},747:e=>{e.exports=require("fs")},605:e=>{e.exports=require("http")},282:e=>{e.exports=require("module")},622:e=>{e.exports=require("path")}};var t={};function __webpack_require__(n){if(t[n]){return t[n].exports}var r=t[n]={exports:{}};var o=true;try{e[n](r,r.exports,__webpack_require__);o=false}finally{if(o)delete t[n]}return r.exports}(()=>{__webpack_require__.n=(e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;__webpack_require__.d(t,{a:t});return t})})();(()=>{__webpack_require__.d=((e,t)=>{for(var n in t){if(__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)){Object.defineProperty(e,n,{enumerable:true,get:t[n]})}}})})();(()=>{__webpack_require__.o=((e,t)=>Object.prototype.hasOwnProperty.call(e,t))})();(()=>{__webpack_require__.r=(e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})})})();__webpack_require__.ab=__dirname+"/";return __webpack_require__(140)})();