#!/usr/bin/env node --unhandled-rejections=strict
/* eslint-disable */
// prettier-ignore
(()=>{var Se=Object.create,U=Object.defineProperty,Ee=Object.getPrototypeOf,xe=Object.prototype.hasOwnProperty,ve=Object.getOwnPropertyNames,Re=Object.getOwnPropertyDescriptor;var Te=e=>U(e,"__esModule",{value:!0});var $e=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var _e=(e,t,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ve(t))!xe.call(e,r)&&r!=="default"&&U(e,r,{get:()=>t[r],enumerable:!(o=Re(t,r))||o.enumerable});return e},m=e=>_e(Te(U(e!=null?Se(Ee(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var ee=$e(I=>{function x(e,t){if(typeof e=="string")return e;if(e){let o,r;if(Array.isArray(e)){for(o=0;o<e.length;o++)if(r=x(e[o],t))return r}else for(o in e)if(t.has(o))return x(e[o],t)}}function w(e,t,o){throw new Error(o?`No known conditions for "${t}" entry in "${e}" package`:`Missing "${t}" export in "${e}" package`)}function Z(e,t){return t===e?".":t[0]==="."?t:t.replace(new RegExp("^"+e+"/"),"./")}function Ce(e,t=".",o={}){let{name:r,exports:n}=e;if(n){let{browser:i,require:c,conditions:a=[]}=o,s=Z(r,t);if(s[0]!=="."&&(s="./"+s),typeof n=="string")return s==="."?n:w(r,s);let p=new Set(["default",...a]);p.add(c?"require":"import"),p.add(i?"browser":"node");let l,d,X=!1;for(l in n){X=l[0]!==".";break}if(X)return s==="."?x(n,p)||w(r,s,1):w(r,s);if(d=n[s])return x(d,p)||w(r,s,1);for(l in n){if(d=l[l.length-1],d==="/"&&s.startsWith(l))return(d=x(n[l],p))?d+s.substring(l.length):w(r,s,1);if(d==="*"&&s.startsWith(l.slice(0,-1))&&s.substring(l.length-1).length>0)return(d=x(n[l],p))?d.replace("*",s.substring(l.length-1)):w(r,s,1)}return w(r,s)}}function Ae(e,t={}){let o=0,r,n=t.browser,i=t.fields||["module","main"];for(n&&!i.includes("browser")&&i.unshift("browser");o<i.length;o++)if(r=e[i[o]]){if(typeof r!="string")if(typeof r=="object"&&i[o]=="browser"){if(typeof n=="string"&&(r=r[n=Z(e.name,n)],r==null))return n}else continue;return typeof r=="string"?"./"+r.replace(/^\.?\//,""):r}}I.legacy=Ae;I.resolve=Ce});var g=m(require("path")),K=m(require("esbuild"));var j=m(require("path")),se=m(require("sass"));var re=m(require("fs"));var F=m(require("fs")),f=m(require("path")),H=m(ee()),Fe=[".tsx",".ts",".jsx",".mjs",".cjs",".js",".json"],He=/^(\/|\.{1,2}(\/|$))/,je=/^\.{0,2}\//,De=(e,t,o)=>{let r=(0,H.resolve)(e,t,{browser:o,require:!o});if(r!=null)return r;if(t!==".")return null;let n=(0,H.legacy)(e,o?{browser:o}:{browser:!1,fields:["main","module"]});return typeof n=="string"?n:null},Le=(e,t)=>{let o=(0,f.normalize)(e),r=(0,f.normalize)(t);return o===r?".":(o.endsWith(f.sep)||(o=o+f.sep),r.startsWith(o)?r.slice(o.length):null)},ke=(e,t,o)=>{let r=t.findPackageLocator((0,f.join)(e,"internal.js"));if(r==null)throw new Error;let{packageLocation:n}=t.getPackageInformation(r),i=(0,f.join)(n,"package.json");if(!F.existsSync(i))return null;let c=JSON.parse(F.readFileSync(i,"utf8")),a=Le(n,e);if(a==null)throw new Error;je.test(a)||(a=`./${a}`),a=(0,f.normalize)(a);let s=De(c,a,o);return s!=null?(0,f.join)(n,s):null},Ne=(e,t,o,r)=>{if(He.test(e))return t;let n=ke(t,o,r);return n?(0,f.normalize)(n):t},Me=(e,t,o,r)=>{let n=o.resolveToUnqualified(e,t);return n==null?null:o.resolveUnqualified(Ne(e,n,o,r),{extensions:Fe})},te=Me;var oe=/()/,Be=()=>({name:"esbuild-scripts-esbuild-plugin-pnp",setup(e){let{findPnpApi:t}=require("module");if(typeof t=="undefined")return;let o=process.cwd();e.onResolve({filter:oe},async r=>{let n=r.importer?r.importer:`${o}/`,i=t(n);if(!i)return;let c=te(r.path,n,i,e.initialOptions.platform!=="node");return c==null?{external:!0}:{namespace:"pnp",path:c}}),e.onLoad!==null&&e.onLoad({filter:oe},async r=>({contents:await re.promises.readFile(r.path,"utf8"),loader:"default"}))}}),ne=Be;var Ge={name:"WebAppResolvePlugin",setup(e){e.onResolve({filter:/data:/},()=>({external:!0}))}},We={name:"sass",setup(e){e.onResolve({filter:/.\.(scss|sass)$/},async t=>({path:(0,j.resolve)((0,j.dirname)(t.importer),t.path)})),e.onLoad({filter:/.\.(scss|sass)$/},async t=>{let{css:o}=await new Promise((r,n)=>{(0,se.render)({file:t.path},(i,c)=>{i?n(i):r(c)})});return{contents:o.toString(),loader:"css",watchFiles:[t.path]}})}},Oe=[Ge,We,ne()],ie=Oe;var Ue=({isServer:e=!1,isProd:t=!1})=>({define:{__SERVER__:String(e),"process.env.NODE_ENV":t?'"production"':'"development"'},bundle:!0,minify:!1,legalComments:"linked",platform:"browser",target:"es2019",logLevel:"error",plugins:ie}),A=Ue;var v=m(require("path")),J=(0,v.join)(__dirname,"templates"),P=".temp",D=(0,v.join)(".temp","__server__.jsx"),b=(0,v.join)("src","pages"),L=(0,v.join)("build","__ssr.js"),ae=(0,v.join)("build","__ssr.css"),Y="build";var T=m(require("path"));var u=m(require("fs")),S=m(require("path")),R=(e,t)=>o=>o?t(o):e(),k=e=>new Promise((t,o)=>(0,u.readdir)(e,(r,n)=>r?o(r):t(n))),le=async e=>Promise.all((await k(e)).flatMap(async t=>{let o=(0,S.join)(e,t);return await z(o)?[o,...await le(o)]:[o]})).then(t=>t.flat()),q=async(e,t)=>{await h(t),await V(t),await Promise.all((await k(e)).map(async o=>{let r=(0,S.join)(e,o),n=(0,S.join)(t,o);await z(r)?await q(r,n):await N(r,n)}))},N=(e,t)=>new Promise((o,r)=>(0,u.copyFile)(e,t,R(o,r))),V=async e=>{let t=await k(e);await Promise.all(t.map(o=>M((0,S.join)(e,o))))},h=e=>new Promise((t,o)=>(0,u.mkdir)(e,{recursive:!0},R(t,o))),z=e=>new Promise((t,o)=>(0,u.lstat)(e,(r,n)=>r?o(r):t(n.isDirectory()))),ce=async(e,t)=>t?(await le(e)).map(o=>(0,S.relative)(e,o)).sort((o,r)=>o.localeCompare(r)):k(e);var M=e=>new Promise((t,o)=>{u.readFile!=null?(0,u.rm)(e,{recursive:!0,force:!0},R(t,o)):z(e).then(r=>r?(0,u.rmdir)(e,{recursive:!0},R(t,o)):(0,u.unlink)(e,R(t,o))).catch(r=>o(r))}),y=(e,t)=>new Promise((o,r)=>(0,u.writeFile)(e,t,R(o,r)));var ue="// @generated",me=e=>e.endsWith("index")?e.substring(0,e.length-(e.endsWith("/index")?6:5)):e,Ie=(e,t)=>{let o=me(e),r=t.filter(a=>a!==e).map(me),n=r.map((a,s)=>`const Component${s} = lazy(() => import('../src/pages/${a}'));`).join(""),i=r.map((a,s)=>`<Route exact path="/${a}"><Suspense fallback={null}><Component${s} /></Suspense></Route>`).join(""),c=`<Switch><Route exact path="/${o}"><Page /></Route>${i}</Switch>`;return`${ue}
import React,{Suspense,lazy}from'react';import{hydrate,render}from'react-dom';
import {BrowserRouter,Route,Switch}from'esbuild-scripts/__internal-components__/react-router';
import Document from '../src/pages/_document.tsx';import Page from '../src/pages/${o}';${n}
const element = <BrowserRouter><Document>${c}</Document></BrowserRouter>;const rootElement = document.getElementById('root');
if (rootElement.hasChildNodes()) hydrate(element, rootElement); else render(element, rootElement);
`},Je=e=>`${ue}
import{createElement as h}from'react';import{renderToString}from'react-dom/server';import Helmet from 'esbuild-scripts/components/Head';
import Document from '../src/pages/_document.tsx';${e.map((t,o)=>`import Page${o} from '../src/pages/${t}';`).join("")}
const map = { ${e.map((t,o)=>`'${t}': Page${o}`).join(", ")} };
module.exports = (path) => ({ divHTML: renderToString(h(Document, {}, h(map[path]))), helmet: Helmet.renderStatic() });
`,Ye=async()=>(await h(b),(await ce(b,!0)).map(t=>{switch((0,T.extname)(t)){case".js":case".jsx":case".ts":case".tsx":break;default:return null}return t.substring(0,t.lastIndexOf("."))}).filter(t=>t!=null&&!t.startsWith("_document"))),B=async()=>{let e=await Ye();return await h(P),await V(P),await Promise.all([...e.map(async t=>{let o=(0,T.join)(P,`${t}.jsx`);await h((0,T.dirname)(o)),await y(o,Ie(t,e))}),y(D,Je(e))]),e};var ze=(e,t)=>t?`<script type="module" src="/${e}"></script>`:`<script src="/${e}"></script>`,qe=(e,t)=>`<link rel="${t?"modulepreload":"preload"}" href="/${e}" />`,Ve=(e,{esModule:t,noJS:o})=>{let r=[],n=[];e.forEach(a=>{!o&&a.endsWith("js")?r.push(a):a.endsWith("css")&&n.push(a)});let i=n.map(a=>`<link rel="stylesheet" href="/${a}" />`).join("")+r.map(a=>qe(a,t)).join(""),c=r.map(a=>ze(a,t)).join("");return{headLinks:i,bodyScriptLinks:c}},pe=(e,t)=>t==null?`<head>${e}</head>`:`<head>${[t.meta.toString(),t.title.toString(),t.link.toString(),t.script.toString(),e].join("")}</head>`,Ke=(e,t,o)=>{let{headLinks:r,bodyScriptLinks:n}=Ve(t,o);if(e==null){let p=pe(r),l=`<body><div id="root"></div>${n}</body>`;return`<!DOCTYPE html><html>${p}${l}</html>`}let{divHTML:i,helmet:c}=e,a=pe(r,c),s=`<body><div id="root">${i}</div>${n}</body>`;return`<!DOCTYPE html><html ${c.htmlAttributes.toString()}>${a}${s}</html>`},G=Ke;var $=e=>process.stderr.isTTY?t=>`[${e}m${t}[0m`:t=>t,_=$(31),C=$(32),de=$(33),W=$(34),Et=$(35),xt=$(36);var fe=async e=>{let{outputFiles:t}=await(0,K.build)({...A({isProd:!0}),entryPoints:e.map(r=>(0,g.join)(P,`${r}.jsx`)),assetNames:"assets/[name]-[hash]",chunkNames:"chunks/[name]-[hash]",entryNames:"[dir]/[name]-[hash]",minify:!0,format:"esm",splitting:!0,write:!1,outdir:"build"}),o=(0,g.resolve)("build");return await Promise.all(t.map(async r=>{await h((0,g.dirname)(r.path)),await y(r.path,r.contents)})),t.map(({path:r})=>(0,g.relative)(o,r))},Qe=async()=>{await(0,K.build)({...A({isServer:!0,isProd:!0}),entryPoints:[D],platform:"node",format:"cjs",outfile:L});try{return require((0,g.resolve)(L))}catch(e){return console.error(_("Unable to perform server side rendering since the server bundle is not correctly generated.")),console.error(_(e)),null}finally{await Promise.all([M(L),M(ae)])}},Xe=async({staticSiteGeneration:e,noJS:t})=>{let o=new Date().getTime();console.error(de("[i] Bundling..."));let r=await B();await q("public","build");let n,i;if(e){if([n,i]=await Promise.all([fe(r),Qe()]),i==null)return!1}else n=await fe(r),i=null;let c=r.map(s=>{let p=n.filter(d=>d.startsWith("chunk")||d.startsWith(s)),l=G(i==null?void 0:i(s),p,{esModule:!0,noJS:t});return{entryPoint:s,html:l}});await Promise.all(c.map(async({entryPoint:s,html:p})=>{let l;s.endsWith("index")?l=(0,g.join)(Y,`${s}.html`):l=(0,g.join)(Y,s,"index.html"),await h((0,g.dirname)(l)),await y(l,p)}));let a=new Date().getTime()-o;return console.error(`\u26A1 ${C(`Build success in ${a}ms.`)}`),!0},Q=Xe;var E=m(require("path"));var Ze=async()=>{await h(b),await Promise.all([N((0,E.join)(J,"_document.tsx"),(0,E.join)(b,"_document.tsx")),N((0,E.join)(J,"index.tsx"),(0,E.join)(b,"index.tsx")),y((0,E.join)(b,"index.css"),""),y((0,E.join)("src","types.d.ts"),`/// <reference types="esbuild-scripts" />
`),h("public")]),console.error(C("esbuild-scripts app initialized."))},ge=Ze;var O=m(require("http")),he=m(require("path")),ye=m(require("esbuild"));var et=(e,t)=>{if(t==null||!t.startsWith("/"))return;let o=t.substring(1);return e.find(r=>r.endsWith("index")?[r,r.substring(0,r.length-5)].includes(o):r===o)},Pe=e=>G(void 0,[`${e}.js`,`${e}.css`],{esModule:!1}),tt=async()=>{let e=await B(),t=await(0,ye.serve)({servedir:"public",port:19815},{...A({}),entryPoints:e.map(r=>(0,he.join)(P,`${r}.jsx`)),sourcemap:"inline",outdir:"public"}),o=(0,O.createServer)((r,n)=>{let i=et(e,r.url);if(i!=null){n.writeHead(200,{"Content-Type":"text/html"}),n.end(Pe(i));return}let c={hostname:t.host,port:t.port,path:r.url,method:r.method,headers:r.headers},a=(0,O.request)(c,s=>{if(s.statusCode===404){n.writeHead(200,{"Content-Type":"text/html"}),n.end(Pe("index"));return}n.writeHead(s.statusCode||200,s.headers),s.pipe(n,{end:!0})});r.pipe(a,{end:!0})}).listen(3e3);console.error(`${C("Serving at")} ${W("http://localhost:3000")}`),await t.wait,o.close()},be=tt;function we(){console.error(W("Usage:")),console.error("- esbuild-script start: start the devserver."),console.error("- esbuild-script build: generate production build."),console.error("- esbuild-script ssg: generate static site."),console.error("- esbuild-script ssg --no-js: generate static site without JS."),console.error("- esbuild-script help: display command line usages.")}async function rt(){let e=process.argv[2]||"";switch(e){case"init":return await ge(),!0;case"start":return await be(),!0;case"ssg":return Q({staticSiteGeneration:!0,noJS:process.argv.includes("--no-js")});case"build":return Q({staticSiteGeneration:!1,noJS:!1});case"help":case"--help":return we(),!0;default:return console.error(_(`Unknown command: '${e}'`)),we(),!1}}async function ot(){try{await rt()||(process.exitCode=1)}catch(e){console.error(_(e)),process.exitCode=1}}ot();})();
