#!/usr/bin/env node
/* eslint-disable */
// prettier-ignore
(()=>{var Q=Object.create,F=Object.defineProperty,X=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty,ee=Object.getOwnPropertyNames,te=Object.getOwnPropertyDescriptor;var re=e=>F(e,"__esModule",{value:!0});var oe=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ee(t))!Z.call(e,o)&&o!=="default"&&F(e,o,{get:()=>t[o],enumerable:!(r=te(t,o))||r.enumerable});return e},s=e=>oe(re(F(e!=null?Q(X(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var c=s(require("path")),H=s(require("esbuild"));var l=s(require("path")),P=(0,l.join)(__dirname,"entries","client.ts"),U=(0,l.join)(__dirname,"entries","server.ts"),ge=(0,l.join)("src","pages"),y=(0,l.join)("build","__ssr.js"),I=(0,l.join)("build","__ssr.css"),A=(0,l.join)("build","index.html"),be=(0,l.join)("build","app.js"),Se=(0,l.join)("build","app.css");var w=s(require("path")),W=s(require("@yarnpkg/esbuild-plugin-pnp")),Y=s(require("esbuild-plugin-sass")),ie={name:"WebAppResolvePlugin",setup(e){e.onResolve({filter:/data:/},()=>({external:!0})),e.onResolve({filter:/USER_DEFINED_APP_ENTRY_POINT/},()=>({path:(0,w.resolve)((0,w.join)("src","App.tsx"))}))}},ne=[ie,(0,Y.default)(),(0,W.pnpPlugin)()],j=ne;var se=({isServer:e=!1,isProd:t=!1})=>({define:{__SERVER__:String(e),"process.env.NODE_ENV":t?'"production"':'"development"'},bundle:!0,minify:!1,target:"es2019",logLevel:"info",plugins:j}),g=se;var n=s(require("fs")),b=s(require("path")),p=(e,t)=>r=>r?t(r):e(),J=e=>new Promise((t,r)=>(0,n.readdir)(e,(o,i)=>o?r(o):t(i)));var D=async(e,t)=>{L(t),ae(t),await Promise.all((await J(e)).map(async r=>{let o=(0,b.join)(e,r),i=(0,b.join)(t,r);await M(o)?await D(o,i):await new Promise((a,u)=>(0,n.copyFile)(o,i,p(a,u)))}))},ae=async e=>{let t=await J(e);await Promise.all(t.map(r=>E((0,b.join)(e,r))))},L=e=>new Promise((t,r)=>(0,n.mkdir)(e,{recursive:!0},p(t,r))),M=e=>new Promise((t,r)=>(0,n.lstat)(e,(o,i)=>o?r(o):t(i.isDirectory())));var v=e=>new Promise((t,r)=>(0,n.readFile)(e,(o,i)=>o?r(o):t(i.toString()))),E=e=>new Promise((t,r)=>{n.readFile!=null?(0,n.rm)(e,{recursive:!0,force:!0},p(t,r)):M(e).then(o=>o?(0,n.rmdir)(e,{recursive:!0},p(t,r)):(0,n.unlink)(e,p(t,r))).catch(o=>r(o))}),B=(e,t)=>new Promise((r,o)=>(0,n.writeFile)(e,t,p(r,o)));var G=s(require("html-minifier")),S=s(require("node-html-parser")),le=(e,t)=>(0,S.parse)(t?`<script type="module" src="${e}"></script>`:`<script src="${e}"></script>`),ce=(e,t)=>(0,S.parse)(`<link rel="${t?"modulepreload":"preload"}" href="${e}" />`),ue=(e,t,r,{esModule:o,noJS:i=!1})=>{let a=(0,S.parse)(e),u=a.querySelector("head"),m=a.querySelector("body");return t!=null&&(a.querySelector("#root").innerHTML=t),r.forEach(R=>{let N=`/${R}`;R.endsWith("js")&&!i?(m.appendChild(le(N,o)),u.appendChild(ce(N,o))):R.endsWith("css")&&u.appendChild((0,S.parse)(`<link rel="stylesheet" href="${N}" />`))}),(0,G.minify)(a.toString(),{minifyCSS:!1,minifyJS:!1,collapseWhitespace:!0,collapseInlineTagWhitespace:!0})},_=ue;var d=e=>process.stderr.isTTY?t=>`[${e}m${t}[0m`:t=>t,f=d(31),C=d(32),O=d(33),h=d(34),Te=d(35),xe=d(36);async function V(){let{outputFiles:e}=await(0,H.build)({...g({isProd:!0}),entryPoints:[P],assetNames:"assets/[name]-[hash]",chunkNames:"chunks/[name]-[hash]",entryNames:"[dir]/[name]-[hash]",minify:!0,format:"esm",splitting:!0,write:!1,outdir:"build"}),t=(0,c.resolve)("build");return await Promise.all(e.map(async r=>{await L((0,c.dirname)(r.path)),await B(r.path,r.contents)})),e.map(({path:r})=>(0,c.relative)(t,r))}async function me(){await(0,H.build)({...g({isServer:!0,isProd:!0}),entryPoints:[U],platform:"node",format:"cjs",logLevel:"error",outfile:y});try{return require((0,c.resolve)(y))}catch(e){return console.error(f("Unable to perform server side rendering since the server bundle is not correctly generated.")),console.error(f(e)),null}finally{await Promise.all([E(y),E(I)])}}async function q(e,t,r){let o=await v(A),i=_(o.toString(),e,t,{esModule:!0,noJS:r});await B(A,i)}async function T({staticSiteGeneration:e,noJS:t}){let r=new Date().getTime();if(console.error(O("[i] Bundling...")),await D("public","build"),e){let[i,a]=await Promise.all([V(),me()]);if(a==null)return!1;await q(a,i,t)}else{let i=await V();await q(null,i,t)}let o=new Date().getTime()-r;return console.error(`\u26A1 ${C(`Build success in ${o}ms.`)}`),!0}var x=s(require("http")),k=s(require("path")),z=s(require("esbuild"));async function $(){let e=_((await v((0,k.join)("public","index.html"))).toString(),"",["app.js","app.css"],{esModule:!1}),t=await(0,z.serve)({servedir:"public",port:19815},{...g({}),entryPoints:[P],sourcemap:"inline",outfile:(0,k.join)("public","app.js")});console.error(h(`[i] ESBuild Server started on http://${t.host}:${t.port}.`));let r=(0,x.createServer)((o,i)=>{if(o.url==="/"){i.writeHead(200,{"Content-Type":"text/html"}),i.end(e);return}let a={hostname:t.host,port:t.port,path:o.url,method:o.method,headers:o.headers},u=(0,x.request)(a,m=>{if(m.statusCode===404){i.writeHead(200,{"Content-Type":"text/html"}),i.end(e);return}i.writeHead(m.statusCode||200,m.headers),m.pipe(i,{end:!0})});o.pipe(u,{end:!0})}).listen(3e3);console.error(h("[i] Proxy Server started.")),console.error(`${C("Serving at")} ${h("http://localhost:3000")}`),await t.wait,r.close()}function K(){console.error(h("Usage:")),console.error("- esbuild-script start: start the devserver."),console.error("- esbuild-script build: generate production build."),console.error("- esbuild-script ssg: generate static site."),console.error("- esbuild-script ssg --no-js: generate static site without JS."),console.error("- esbuild-script help: display command line usages.")}async function pe(){let e=process.argv[2]||"";switch(e){case"start":return await $(),!0;case"ssg":return T({staticSiteGeneration:!0,noJS:process.argv.includes("--no-js")});case"build":return T({staticSiteGeneration:!1,noJS:!1});case"help":case"--help":return K(),!0;default:return console.error(f(`Unknown command: '${e}'`)),K(),!1}}async function de(){try{await pe()||(process.exitCode=1)}catch(e){console.error(f(e)),process.exitCode=1}}de();})();
