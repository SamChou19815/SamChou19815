#!/usr/bin/env node
/* eslint-disable */
// prettier-ignore
(()=>{var Q=Object.create,F=Object.defineProperty,X=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty,ee=Object.getOwnPropertyNames,te=Object.getOwnPropertyDescriptor;var oe=e=>F(e,"__esModule",{value:!0});var re=(e,t,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ee(t))!Z.call(e,r)&&r!=="default"&&F(e,r,{get:()=>t[r],enumerable:!(o=te(t,r))||o.enumerable});return e},s=e=>re(oe(F(e!=null?Q(X(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var c=s(require("path")),H=s(require("esbuild"));var a=s(require("path")),g=(0,a.join)(__dirname,"entries","client.ts"),U=(0,a.join)(__dirname,"entries","server.ts"),P=(0,a.join)("build","__ssr.js"),I=(0,a.join)("build","__ssr.css"),A=(0,a.join)("build","index.html"),be=(0,a.join)("build","app.js"),Se=(0,a.join)("build","app.css");var y=s(require("path")),W=s(require("@yarnpkg/esbuild-plugin-pnp")),Y=s(require("esbuild-plugin-sass")),ie={name:"WebAppResolvePlugin",setup(e){e.onResolve({filter:/data:/},()=>({external:!0})),e.onResolve({filter:/USER_DEFINED_APP_ENTRY_POINT/},()=>({path:(0,y.resolve)((0,y.join)("src","App.tsx"))}))}},ne=[ie,(0,Y.default)(),(0,W.pnpPlugin)()],j=ne;var se=({isServer:e=!1,isProd:t=!1})=>({define:{__SERVER__:String(e),"process.env.NODE_ENV":t?'"production"':'"development"'},bundle:!0,minify:!1,target:"es2019",logLevel:"info",plugins:j}),b=se;var n=s(require("fs")),w=s(require("path")),p=(e,t)=>o=>o?t(o):e(),J=e=>new Promise((t,o)=>(0,n.readdir)(e,(r,i)=>r?o(r):t(i))),L=async(e,t)=>{D(t),le(t),await Promise.all((await J(e)).map(async o=>{let r=(0,w.join)(e,o),i=(0,w.join)(t,o);await M(r)?await L(r,i):await new Promise((l,u)=>(0,n.copyFile)(r,i,p(l,u)))}))},le=async e=>{let t=await J(e);await Promise.all(t.map(o=>E((0,w.join)(e,o))))},D=e=>new Promise((t,o)=>(0,n.mkdir)(e,{recursive:!0},p(t,o))),M=e=>new Promise((t,o)=>(0,n.lstat)(e,(r,i)=>r?o(r):t(i.isDirectory()))),v=e=>new Promise((t,o)=>(0,n.readFile)(e,(r,i)=>r?o(r):t(i.toString()))),E=e=>new Promise((t,o)=>{n.readFile!=null?(0,n.rm)(e,{recursive:!0,force:!0},p(t,o)):M(e).then(r=>r?(0,n.rmdir)(e,{recursive:!0},p(t,o)):(0,n.unlink)(e,p(t,o))).catch(r=>o(r))}),B=(e,t)=>new Promise((o,r)=>(0,n.writeFile)(e,t,p(o,r)));var G=s(require("html-minifier")),S=s(require("node-html-parser")),ae=(e,t)=>(0,S.parse)(t?`<script type="module" src="${e}"></script>`:`<script src="${e}"></script>`),ce=(e,t)=>(0,S.parse)(`<link rel="${t?"modulepreload":"preload"}" href="${e}" />`),ue=(e,t,o,{esModule:r,noJS:i=!1})=>{let l=(0,S.parse)(e),u=l.querySelector("head"),m=l.querySelector("body");return t!=null&&(l.querySelector("#root").innerHTML=t),o.forEach(R=>{let N=`/${R}`;R.endsWith("js")&&!i?(m.appendChild(ae(N,r)),u.appendChild(ce(N,r))):R.endsWith("css")&&u.appendChild((0,S.parse)(`<link rel="stylesheet" href="${N}" />`))}),(0,G.minify)(l.toString(),{minifyCSS:!1,minifyJS:!1,collapseWhitespace:!0,collapseInlineTagWhitespace:!0})},_=ue;var d=e=>process.stderr.isTTY?t=>`[${e}m${t}[0m`:t=>t,f=d(31),C=d(32),O=d(33),h=d(34),Ce=d(35),Te=d(36);async function V(){let{outputFiles:e}=await(0,H.build)({...b({isProd:!0}),entryPoints:[g],assetNames:"assets/[name]-[hash]",chunkNames:"chunks/[name]-[hash]",entryNames:"[dir]/[name]-[hash]",minify:!0,format:"esm",splitting:!0,write:!1,outdir:"build"}),t=(0,c.resolve)("build");return await Promise.all(e.map(async o=>{await D((0,c.dirname)(o.path)),await B(o.path,o.contents)})),e.map(({path:o})=>(0,c.relative)(t,o))}async function me(){await(0,H.build)({...b({isServer:!0,isProd:!0}),entryPoints:[U],platform:"node",format:"cjs",logLevel:"error",outfile:P});try{return require((0,c.resolve)(P))}catch(e){return console.error(f("Unable to perform server side rendering since the server bundle is not correctly generated.")),console.error(f(e)),null}finally{await Promise.all([E(P),E(I)])}}async function q(e,t,o){let r=await v(A),i=_(r.toString(),e,t,{esModule:!0,noJS:o});await B(A,i)}async function T({staticSiteGeneration:e,noJS:t}){let o=new Date().getTime();if(console.error(O("[i] Bundling...")),await L("public","build"),e){let[i,l]=await Promise.all([V(),me()]);if(l==null)return!1;await q(l,i,t)}else{let i=await V();await q(null,i,t)}let r=new Date().getTime()-o;return console.error(`\u26A1 ${C(`Build success in ${r}ms.`)}`),!0}var x=s(require("http")),k=s(require("path")),z=s(require("esbuild"));async function $(){let e=_((await v((0,k.join)("public","index.html"))).toString(),"",["app.js","app.css"],{esModule:!1}),t=await(0,z.serve)({servedir:"public",port:19815},{...b({}),entryPoints:[g],sourcemap:"inline",outfile:(0,k.join)("public","app.js")});console.error(h(`[i] ESBuild Server started on http://${t.host}:${t.port}.`));let o=(0,x.createServer)((r,i)=>{if(r.url==="/"){i.writeHead(200,{"Content-Type":"text/html"}),i.end(e);return}let l={hostname:t.host,port:t.port,path:r.url,method:r.method,headers:r.headers},u=(0,x.request)(l,m=>{if(m.statusCode===404){i.writeHead(200,{"Content-Type":"text/html"}),i.end(e);return}i.writeHead(m.statusCode||200,m.headers),m.pipe(i,{end:!0})});r.pipe(u,{end:!0})}).listen(3e3);console.error(h("[i] Proxy Server started.")),console.error(`${C("Serving at")} ${h("http://localhost:3000")}`),await t.wait,o.close()}function K(){console.error(h("Usage:")),console.error("- esbuild-script start: start the devserver."),console.error("- esbuild-script build: generate production build."),console.error("- esbuild-script ssg: generate static site."),console.error("- esbuild-script ssg --no-js: generate static site without JS."),console.error("- esbuild-script help: display command line usages.")}async function pe(){let e=process.argv[2]||"";switch(e){case"start":return await $(),!0;case"ssg":return T({staticSiteGeneration:!0,noJS:process.argv.includes("--no-js")});case"build":return T({staticSiteGeneration:!1,noJS:!1});case"help":case"--help":return K(),!0;default:return console.error(f(`Unknown command: '${e}'`)),K(),!1}}async function de(){try{await pe()||(process.exitCode=1)}catch(e){console.error(f(e)),process.exitCode=1}}de();})();
