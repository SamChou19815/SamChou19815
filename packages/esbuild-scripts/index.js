#!/usr/bin/env node --unhandled-rejections=strict
/* eslint-disable */
// prettier-ignore
(()=>{var se=Object.create,L=Object.defineProperty,ie=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty,le=Object.getOwnPropertyNames,ce=Object.getOwnPropertyDescriptor;var me=e=>L(e,"__esModule",{value:!0});var ue=(e,t,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of le(t))!ae.call(e,r)&&r!=="default"&&L(e,r,{get:()=>t[r],enumerable:!(o=ce(t,r))||o.enumerable});return e},m=e=>ue(me(L(e!=null?se(ie(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var u=m(require("path")),G=m(require("esbuild"));var T=m(require("path")),Y=m(require("@yarnpkg/esbuild-plugin-pnp")),I=m(require("sass")),de={name:"WebAppResolvePlugin",setup(e){e.onResolve({filter:/data:/},()=>({external:!0}))}},pe={name:"sass",setup(e){e.onResolve({filter:/.\.(scss|sass)$/},async t=>({path:(0,T.resolve)((0,T.dirname)(t.importer),t.path)})),e.onLoad({filter:/.\.(scss|sass)$/},async t=>{let{css:o}=await new Promise((r,n)=>{(0,I.render)({file:t.path},(i,c)=>{i?n(i):r(c)})});return{contents:o.toString(),loader:"css",watchFiles:[t.path]}})}},ge=[de,pe,(0,Y.pnpPlugin)()],J=ge;var fe=({isServer:e=!1,isProd:t=!1})=>({define:{__SERVER__:String(e),"process.env.NODE_ENV":t?'"production"':'"development"'},bundle:!0,minify:!1,target:"es2019",logLevel:"error",plugins:J}),E=fe;var x=m(require("path")),p=".temp",R=(0,x.join)(".temp","__server__.jsx"),j=(0,x.join)("src","pages"),v=(0,x.join)("build","__ssr.js"),U=(0,x.join)("build","__ssr.css"),k="build";var P=m(require("path"));var l=m(require("fs")),f=m(require("path")),h=(e,t)=>o=>o?t(o):e(),$=e=>new Promise((t,o)=>(0,l.readdir)(e,(r,n)=>r?o(r):t(n))),z=async e=>Promise.all((await $(e)).flatMap(async t=>{let o=(0,f.join)(e,t);return await M(o)?[o,...await z(o)]:[o]})).then(t=>t.flat()),N=async(e,t)=>{await g(t),await B(t),await Promise.all((await $(e)).map(async o=>{let r=(0,f.join)(e,o),n=(0,f.join)(t,o);await M(r)?await N(r,n):await new Promise((i,c)=>(0,l.copyFile)(r,n,h(i,c)))}))},B=async e=>{let t=await $(e);await Promise.all(t.map(o=>_((0,f.join)(e,o))))},g=e=>new Promise((t,o)=>(0,l.mkdir)(e,{recursive:!0},h(t,o))),M=e=>new Promise((t,o)=>(0,l.lstat)(e,(r,n)=>r?o(r):t(n.isDirectory()))),V=async(e,t)=>t?(await z(e)).map(o=>(0,f.relative)(e,o)).sort((o,r)=>o.localeCompare(r)):$(e);var _=e=>new Promise((t,o)=>{l.readFile!=null?(0,l.rm)(e,{recursive:!0,force:!0},h(t,o)):M(e).then(r=>r?(0,l.rmdir)(e,{recursive:!0},h(t,o)):(0,l.unlink)(e,h(t,o))).catch(r=>o(r))}),y=(e,t)=>new Promise((o,r)=>(0,l.writeFile)(e,t,h(o,r)));var K="// @generated",Q=e=>e.endsWith("index")?e.substring(0,e.length-(e.endsWith("/index")?6:5)):e,he=(e,t)=>{let o=Q(e),r=t.filter(s=>s!==e).map(Q),n=r.map((s,a)=>`const Component${a} = lazy(() => import('../src/pages/${s}'));`).join(""),i=r.map((s,a)=>`<Route exact path="/${s}"><Suspense fallback={null}><Component${a} /></Suspense></Route>`).join(""),c=`<Switch><Route exact path="/${o}"><Page /></Route>${i}</Switch>`;return`${K}
import React,{Suspense,lazy}from'react';import{hydrate,render}from'react-dom';
import {BrowserRouter,Route,Switch}from'esbuild-scripts/__internal-components__/react-router';
import Document from '../src/pages/_document.tsx';import Page from '../src/pages/${o}';${n}
const element = <BrowserRouter><Document>${c}</Document></BrowserRouter>;const rootElement = document.getElementById('root');
if (rootElement.hasChildNodes()) hydrate(element, rootElement); else render(element, rootElement);
`},ye=e=>`${K}
import{createElement as h}from'react';import{renderToString}from'react-dom/server';import Helmet from 'esbuild-scripts/components/Head';
import Document from '../src/pages/_document.tsx';${e.map((t,o)=>`import Page${o} from '../src/pages/${t}';`).join("")}
const map = { ${e.map((t,o)=>`'${t}': Page${o}`).join(", ")} };
module.exports = (path) => ({ divHTML: renderToString(h(Document, {}, h(map[path]))), helmet: Helmet.renderStatic() });
`,Pe=async()=>(await g(j),(await V(j,!0)).map(t=>{switch((0,P.extname)(t)){case".js":case".jsx":case".ts":case".tsx":break;default:return null}return t.substring(0,t.lastIndexOf("."))}).filter(t=>t!=null&&!t.startsWith("_document"))),C=async()=>{let e=await Pe();return await g(p),await B(p),await Promise.all([...e.map(async t=>{let o=(0,P.join)(p,`${t}.jsx`);await g((0,P.dirname)(o)),await y(o,he(t,e))}),y(R,ye(e))]),e};var Se=(e,t)=>t?`<script type="module" src="/${e}"></script>`:`<script src="/${e}"></script>`,be=(e,t)=>`<link rel="${t?"modulepreload":"preload"}" href="/${e}" />`,we=(e,{esModule:t,noJS:o})=>{let r=[],n=[];e.forEach(s=>{!o&&s.endsWith("js")?r.push(s):s.endsWith("css")&&n.push(s)});let i=n.map(s=>`<link rel="stylesheet" href="/${s}" />`).join("")+r.map(s=>be(s,t)).join(""),c=r.map(s=>Se(s,t)).join("");return{headLinks:i,bodyScriptLinks:c}},X=(e,t)=>t==null?`<head>${e}</head>`:`<head>${[t.meta.toString(),t.title.toString(),t.link.toString(),t.script.toString(),e].join("")}</head>`,Ee=(e,t,o)=>{let{headLinks:r,bodyScriptLinks:n}=we(t,o);if(e==null){let w=X(r),d=`<body><div id="root"></div>${n}</body>`;return`<!DOCTYPE html><html>${w}${d}</html>`}let{divHTML:i,helmet:c}=e,s=X(r,c),a=`<body><div id="root">${i}</div>${n}</body>`;return`<!DOCTYPE html><html ${c.htmlAttributes.toString()}>${s}${a}</html>`},H=Ee;var S=e=>process.stderr.isTTY?t=>`[${e}m${t}[0m`:t=>t,b=S(31),F=S(32),Z=S(33),D=S(34),Oe=S(35),Ye=S(36);var q=async e=>{let{outputFiles:t}=await(0,G.build)({...E({isProd:!0}),entryPoints:e.map(r=>(0,u.join)(p,`${r}.jsx`)),assetNames:"assets/[name]-[hash]",chunkNames:"chunks/[name]-[hash]",entryNames:"[dir]/[name]-[hash]",minify:!0,format:"esm",splitting:!0,write:!1,outdir:"build"}),o=(0,u.resolve)("build");return await Promise.all(t.map(async r=>{await g((0,u.dirname)(r.path)),await y(r.path,r.contents)})),t.map(({path:r})=>(0,u.relative)(o,r))},xe=async()=>{await(0,G.build)({...E({isServer:!0,isProd:!0}),entryPoints:[R],platform:"node",format:"cjs",outfile:v});try{return require((0,u.resolve)(v))}catch(e){return console.error(b("Unable to perform server side rendering since the server bundle is not correctly generated.")),console.error(b(e)),null}finally{await Promise.all([_(v),_(U)])}},Te=async({staticSiteGeneration:e,noJS:t})=>{let o=new Date().getTime();console.error(Z("[i] Bundling..."));let r=await C();await N("public","build");let n,i;if(e){if([n,i]=await Promise.all([q(r),xe()]),i==null)return!1}else n=await q(r),i=null;let c=r.map(a=>{let w=n.filter(O=>O.startsWith("chunk")||O.startsWith(a)),d=H(i==null?void 0:i(a),w,{esModule:!0,noJS:t});return{entryPoint:a,html:d}});await Promise.all(c.map(async({entryPoint:a,html:w})=>{let d;a.endsWith("index")?d=(0,u.join)(k,`${a}.html`):d=(0,u.join)(k,a,"index.html"),await g((0,u.dirname)(d)),await y(d,w)}));let s=new Date().getTime()-o;return console.error(`\u26A1 ${F(`Build success in ${s}ms.`)}`),!0},W=Te;var A=m(require("http")),ee=m(require("path")),te=m(require("esbuild"));var Re=(e,t)=>{if(t==null||!t.startsWith("/"))return;let o=t.substring(1);return e.find(r=>r.endsWith("index")?[r,r.substring(0,r.length-5)].includes(o):r===o)},re=e=>H(void 0,[`${e}.js`,`${e}.css`],{esModule:!1}),ve=async()=>{let e=await C(),t=await(0,te.serve)({servedir:"public",port:19815},{...E({}),entryPoints:e.map(r=>(0,ee.join)(p,`${r}.jsx`)),sourcemap:"inline",outdir:"public"}),o=(0,A.createServer)((r,n)=>{let i=Re(e,r.url);if(i!=null){n.writeHead(200,{"Content-Type":"text/html"}),n.end(re(i));return}let c={hostname:t.host,port:t.port,path:r.url,method:r.method,headers:r.headers},s=(0,A.request)(c,a=>{if(a.statusCode===404){n.writeHead(200,{"Content-Type":"text/html"}),n.end(re("index"));return}n.writeHead(a.statusCode||200,a.headers),a.pipe(n,{end:!0})});r.pipe(s,{end:!0})}).listen(3e3);console.error(`${F("Serving at")} ${D("http://localhost:3000")}`),await t.wait,o.close()},oe=ve;function ne(){console.error(D("Usage:")),console.error("- esbuild-script start: start the devserver."),console.error("- esbuild-script build: generate production build."),console.error("- esbuild-script ssg: generate static site."),console.error("- esbuild-script ssg --no-js: generate static site without JS."),console.error("- esbuild-script help: display command line usages.")}async function $e(){let e=process.argv[2]||"";switch(e){case"start":return await oe(),!0;case"ssg":return W({staticSiteGeneration:!0,noJS:process.argv.includes("--no-js")});case"build":return W({staticSiteGeneration:!1,noJS:!1});case"help":case"--help":return ne(),!0;default:return console.error(b(`Unknown command: '${e}'`)),ne(),!1}}async function _e(){try{await $e()||(process.exitCode=1)}catch(e){console.error(b(e)),process.exitCode=1}}_e();})();
