#!/usr/bin/env node --unhandled-rejections=strict
/* eslint-disable */
// prettier-ignore
(()=>{var $t=Object.create,U=Object.defineProperty,At=Object.getPrototypeOf,Ct=Object.prototype.hasOwnProperty,Ht=Object.getOwnPropertyNames,Lt=Object.getOwnPropertyDescriptor;var jt=t=>U(t,"__esModule",{value:!0});var Dt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ft=(t,e,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ht(e))!Ct.call(t,r)&&r!=="default"&&U(t,r,{get:()=>e[r],enumerable:!(o=Lt(e,r))||o.enumerable});return t},m=t=>Ft(jt(U(t!=null?$t(At(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var nt=Dt(z=>{function R(t,e){if(typeof t=="string")return t;if(t){let o,r;if(Array.isArray(t)){for(o=0;o<t.length;o++)if(r=R(t[o],e))return r}else for(o in t)if(e.has(o))return R(t[o],e)}}function E(t,e,o){throw new Error(o?`No known conditions for "${e}" entry in "${t}" package`:`Missing "${e}" export in "${t}" package`)}function ot(t,e){return e===t?".":e[0]==="."?e:e.replace(new RegExp("^"+t+"/"),"./")}function kt(t,e=".",o={}){let{name:r,exports:n}=t;if(n){let{browser:a,require:c,conditions:s=[]}=o,i=ot(r,e);if(i[0]!=="."&&(i="./"+i),typeof n=="string")return i==="."?n:E(r,i);let u=new Set(["default",...s]);u.add(c?"require":"import"),u.add(a?"browser":"node");let p,h,X=!1;for(p in n){X=p[0]!==".";break}if(X)return i==="."?R(n,u)||E(r,i,1):E(r,i);if(h=n[i])return R(h,u)||E(r,i,1);for(p in n){if(h=p[p.length-1],h==="/"&&i.startsWith(p))return(h=R(n[p],u))?h+i.substring(p.length):E(r,i,1);if(h==="*"&&i.startsWith(p.slice(0,-1))&&i.substring(p.length-1).length>0)return(h=R(n[p],u))?h.replace("*",i.substring(p.length-1)):E(r,i,1)}return E(r,i)}}function Nt(t,e={}){let o=0,r,n=e.browser,a=e.fields||["module","main"];for(n&&!a.includes("browser")&&a.unshift("browser");o<a.length;o++)if(r=t[a[o]]){if(typeof r!="string")if(typeof r=="object"&&a[o]=="browser"){if(typeof n=="string"&&(r=r[n=ot(t.name,n)],r==null))return n}else continue;return typeof r=="string"?"./"+r.replace(/^\.?\//,""):r}}z.legacy=Nt;z.resolve=kt});var f=m(require("path")),K=m(require("esbuild"));var ct=m(require("module")),k=m(require("path")),ut=m(require("@mdx-js/mdx")),mt=m(require("sass"));var l=m(require("fs")),x=m(require("path")),v=(t,e)=>o=>o?e(o):t(),L=t=>new Promise((e,o)=>(0,l.readdir)(t,(r,n)=>r?o(r):e(n))),Z=async t=>Promise.all((await L(t)).flatMap(async e=>{let o=(0,x.join)(t,e);return await I(o)?[o,...await Z(o)]:[o]})).then(e=>e.flat()),J=async(t,e)=>{await g(e),await Y(e),await Promise.all((await L(t)).map(async o=>{let r=(0,x.join)(t,o),n=(0,x.join)(e,o);await I(r)?await J(r,n):await j(r,n)}))},j=(t,e)=>new Promise((o,r)=>(0,l.copyFile)(t,e,v(o,r))),Y=async t=>{let e=await L(t);await Promise.all(e.map(o=>C((0,x.join)(t,o))))},g=t=>new Promise((e,o)=>(0,l.mkdir)(t,{recursive:!0},v(e,o))),tt=t=>new Promise(e=>(0,l.access)(t,void 0,o=>e(o==null))),I=t=>new Promise((e,o)=>(0,l.lstat)(t,(r,n)=>r?o(r):e(n.isDirectory()))),et=async(t,e)=>e?(await Z(t)).map(o=>(0,x.relative)(t,o)).sort((o,r)=>o.localeCompare(r)):L(t),rt=t=>new Promise((e,o)=>(0,l.readFile)(t,(r,n)=>r?o(r):e(n.toString()))),C=t=>new Promise((e,o)=>{l.readFile!=null?(0,l.rm)(t,{recursive:!0,force:!0},v(e,o)):I(t).then(r=>r?(0,l.rmdir)(t,{recursive:!0},v(e,o)):(0,l.unlink)(t,v(e,o))).catch(r=>o(r))}),y=(t,e)=>new Promise((o,r)=>(0,l.writeFile)(t,e,v(o,r)));var st=m(require("fs"));var D=m(require("fs")),d=m(require("path")),F=m(nt()),Bt=[".tsx",".ts",".jsx",".mjs",".cjs",".js",".json"],Mt=/^(\/|\.{1,2}(\/|$))/,Gt=/^\.{0,2}\//,Wt=(t,e,o)=>{let r=(0,F.resolve)(t,e,{browser:o,require:!o});if(r!=null)return r;let n=(0,F.legacy)(t,o?{browser:o}:{browser:!1,fields:["main","module"]});return typeof n=="string"?e==="."?n:null:n&&(n[e]||n[`${e}.js`]||n[`./${e}`]||n[`./${e}.js`])||null},Ot=(t,e)=>{let o=(0,d.normalize)(t),r=(0,d.normalize)(e);return o===r?".":(o.endsWith(d.sep)||(o=o+d.sep),r.startsWith(o)?r.slice(o.length):null)},Ut=(t,e,o)=>{let r=e.findPackageLocator((0,d.join)(t,"internal.js"));if(r==null)throw new Error;let{packageLocation:n}=e.getPackageInformation(r),a=(0,d.join)(n,"package.json");if(!D.existsSync(a))return null;let c=JSON.parse(D.readFileSync(a,"utf8")),s=Ot(n,t);if(s==null)throw new Error;Gt.test(s)||(s=`./${s}`),s=(0,d.normalize)(s);let i=Wt(c,s,o);return i!=null?(0,d.join)(n,i):null},It=(t,e,o,r)=>{if(Mt.test(t))return e;let n=Ut(e,o,r);return n?(0,d.normalize)(n):e},Jt=(t,e,o,r)=>{let n=o.resolveToUnqualified(t,e);return n==null?null:o.resolveUnqualified(It(t,n,o,r),{extensions:Bt})},it=Jt;var at=/()/,Yt=()=>({name:"esbuild-scripts-esbuild-plugin-pnp",setup(t){let{findPnpApi:e}=require("module");if(typeof e=="undefined")return;let o=process.cwd();t.onResolve({filter:at},async r=>{let n=r.importer?r.importer:`${o}/`,a=e(n);if(!a)return;let c=it(r.path,n,a,t.initialOptions.platform!=="node");return c==null?{external:!0}:{namespace:"pnp",path:c}}),t.onLoad!==null&&t.onLoad({filter:at},async r=>({contents:await st.promises.readFile(r.path,"utf8"),loader:"default"}))}}),lt=Yt;var zt={name:"WebAppResolvePlugin",setup(t){t.onResolve({filter:/data:/},()=>({external:!0}))}},qt={name:"sass",setup(t){t.onResolve({filter:/.\.(scss|sass)$/},async e=>e.path.startsWith(".")?{path:(0,k.resolve)((0,k.dirname)(e.importer),e.path)}:{path:(0,ct.createRequire)(e.importer).resolve(e.path)}),t.onLoad({filter:/.\.(scss|sass)$/},async e=>{let{css:o}=await new Promise((r,n)=>{(0,mt.render)({file:e.path},(a,c)=>{a?n(a):r(c)})});return{contents:o.toString(),loader:"css",watchFiles:[e.path]}})}},Vt={name:"mdx",setup(t){t.onLoad({filter:/\.mdx?$/},async e=>{let o=await rt(e.path);return{contents:`import React from'react';
import mdx from'esbuild-scripts/__internal-components__/mdx';
${await(0,ut.default)(o)}`,loader:"jsx"}})}},Kt=[zt,qt,Vt,lt()],pt=Kt;var Qt=({isServer:t=!1,isProd:e=!1})=>({define:{__SERVER__:String(t),"process.env.NODE_ENV":e?'"production"':'"development"'},bundle:!0,minify:!1,legalComments:"linked",platform:"browser",target:"es2019",logLevel:"error",plugins:pt}),H=Qt;var b=m(require("path")),q=(0,b.join)(__dirname,"templates"),S=".temp",N=(0,b.join)(".temp","__server__.jsx"),w=(0,b.join)("src","pages"),dt=(0,b.join)("src","generated-pages"),B=(0,b.join)("build","__ssr.jsx"),ft=(0,b.join)("build","__ssr.jsx.LEGAL.txt"),gt=(0,b.join)("build","__ssr.css"),V="build";var P=m(require("path"));var Pt="// @generated",ht=t=>t.endsWith("index")?t.substring(0,t.length-(t.endsWith("/index")?6:5)):t,Xt=(t,e)=>{let o=ht(t),r=e.filter(i=>i!==t).map(ht),n=(0,P.join)((0,P.relative)((0,P.dirname)(t),".."),"src","pages"),a=r.map((i,u)=>`const Component${u} = lazy(() => import('${n}/${i}'));`).join(""),c=r.map((i,u)=>`<Route exact path="/${i}"><Suspense fallback={null}><Component${u} /></Suspense></Route>`).join(""),s=`<Switch><Route exact path="/${o}"><Page /></Route>${c}</Switch>`;return`${Pt}
import React,{Suspense,lazy}from'react';import{hydrate,render}from'react-dom';
import {BrowserRouter,Route,Switch}from'esbuild-scripts/__internal-components__/react-router';
import Document from '${n}/_document.tsx';import Page from '${n}/${o}';${a}
const element = <BrowserRouter><Document>${s}</Document></BrowserRouter>;const rootElement = document.getElementById('root');
if (rootElement.hasChildNodes()) hydrate(element, rootElement); else render(element, rootElement);
`},Zt=t=>`${Pt}
import React from 'react';
import {renderToString} from'react-dom/server';
import Helmet from 'esbuild-scripts/components/Head';
import {StaticRouter}from'esbuild-scripts/__internal-components__/react-router';
import Document from '../src/pages/_document.tsx';
${t.map((e,o)=>`import Page${o} from '../src/pages/${e}';`).join(`
`)}
const map = { ${t.map((e,o)=>`'${e}': Page${o}`).join(", ")} };
module.exports = (path) => ({
  divHTML: renderToString(
    <StaticRouter location={'/'+path}>
      <Document>{React.createElement(map[path])}</Document>
    </StaticRouter>
  ),
  noJS: map[path].noJS,
  helmet: Helmet.renderStatic(),
});
`,yt=async t=>await tt(t)?et(t,!0):[],te=async()=>{await g(w);let[t,e]=await Promise.all([yt(w),yt(dt)]);return[...t,...e].map(r=>{switch((0,P.extname)(r)){case".js":case".jsx":case".ts":case".tsx":break;default:return null}return r.substring(0,r.lastIndexOf("."))}).filter(r=>r!=null&&!r.startsWith("_document"))},M=async()=>{let t=await te();return await g(S),await Y(S),await Promise.all([...t.map(async e=>{let o=(0,P.join)(S,`${e}.jsx`);await g((0,P.dirname)(o)),await y(o,Xt(e,t))}),y(N,Zt(t))]),t};var ee=(t,e)=>e?`<script type="module" src="/${t}"></script>`:`<script src="/${t}"></script>`,re=(t,e)=>`<link rel="${e?"modulepreload":"preload"}" href="/${t}" />`,oe=(t,e,o)=>{let r=[],n=[];t.forEach(s=>{!o&&s.endsWith("js")?r.push(s):s.endsWith("css")&&n.push(s)});let a=n.map(s=>`<link rel="stylesheet" href="/${s}" />`).join("")+r.map(s=>re(s,e)).join(""),c=r.map(s=>ee(s,e)).join("");return{headLinks:a,bodyScriptLinks:c}},bt=(t,e)=>e==null?`<head>${t}</head>`:`<head>${[e.meta.toString(),e.title.toString(),e.link.toString(),e.script.toString(),t].join("")}</head>`,ne=(t,e,o)=>{let{headLinks:r,bodyScriptLinks:n}=oe(e,o,t==null?void 0:t.noJS);if(t==null){let u=bt(r),p=`<body><div id="root"></div>${n}</body>`;return`<!DOCTYPE html><html>${u}${p}</html>`}let{divHTML:a,helmet:c}=t,s=bt(r,c),i=`<body><div id="root">${a}</div>${n}</body>`;return`<!DOCTYPE html><html ${c.htmlAttributes.toString()}>${s}${i}</html>`},G=ne;var T=t=>process.stderr.isTTY?e=>`[${t}m${e}[0m`:e=>e,$=T(31),A=T(32),St=T(33),W=T(34),He=T(35),Le=T(36);var wt=async t=>{let{outputFiles:e}=await(0,K.build)({...H({isProd:!0}),entryPoints:t.map(r=>(0,f.join)(S,`${r}.jsx`)),assetNames:"assets/[name]-[hash]",chunkNames:"chunks/[name]-[hash]",entryNames:"[dir]/[name]-[hash]",minify:!0,format:"esm",splitting:!0,write:!1,outdir:"build"}),o=(0,f.resolve)("build");return await Promise.all(e.map(async r=>{await g((0,f.dirname)(r.path)),await y(r.path,r.contents)})),e.map(({path:r})=>(0,f.relative)(o,r))},ie=async()=>{await(0,K.build)({...H({isServer:!0,isProd:!0}),entryPoints:[N],platform:"node",format:"cjs",outfile:B});try{return require((0,f.resolve)(B))}catch(t){return console.error($("Unable to perform server side rendering since the server bundle is not correctly generated.")),console.error($(t)),null}finally{await Promise.all([C(B),C(ft),C(gt)])}},se=async t=>{let e=new Date().getTime();console.error(St("[i] Bundling..."));let o=await M();await J("public","build");let r,n;if(t){if([r,n]=await Promise.all([wt(o),ie()]),n==null)return!1}else r=await wt(o),n=null;let a=o.map(s=>{let i=r.filter(p=>p.startsWith("chunk")||p.startsWith(s)),u=G(n==null?void 0:n(s),i,!0);return{entryPoint:s,html:u}});await Promise.all(a.map(async({entryPoint:s,html:i})=>{let u;s.endsWith("index")?u=(0,f.join)(V,`${s}.html`):u=(0,f.join)(V,s,"index.html"),await g((0,f.dirname)(u)),await y(u,i)}));let c=new Date().getTime()-e;return console.error(`\u26A1 ${A(`Build success in ${c}ms.`)}`),!0},Q=se;var _=m(require("path"));var ae=async()=>{await g(w),await Promise.all([j((0,_.join)(q,"_document.tsx"),(0,_.join)(w,"_document.tsx")),j((0,_.join)(q,"index.tsx"),(0,_.join)(w,"index.tsx")),y((0,_.join)(w,"index.css"),""),y((0,_.join)("src","types.d.ts"),`/// <reference types="esbuild-scripts" />
`),g("public")]),console.error(A("esbuild-scripts app initialized."))},xt=ae;var O=m(require("http")),Et=m(require("path")),_t=m(require("esbuild"));var le=(t,e)=>{if(e==null||!e.startsWith("/"))return;let o=e.substring(1);return t.find(r=>r.endsWith("index")?[r,r.substring(0,r.length-5)].includes(o):r===o)},vt=t=>G(void 0,[`${t}.js`,`${t}.css`],!1),ce=async()=>{let t=await M(),e=await(0,_t.serve)({servedir:"public",port:19815},{...H({}),entryPoints:t.map(r=>(0,Et.join)(S,`${r}.jsx`)),sourcemap:"inline",outdir:"public"}),o=(0,O.createServer)((r,n)=>{let a=le(t,r.url);if(a!=null){n.writeHead(200,{"Content-Type":"text/html"}),n.end(vt(a));return}let c={hostname:e.host,port:e.port,path:r.url,method:r.method,headers:r.headers},s=(0,O.request)(c,i=>{if(i.statusCode===404){n.writeHead(200,{"Content-Type":"text/html"}),n.end(vt("index"));return}n.writeHead(i.statusCode||200,i.headers),i.pipe(n,{end:!0})});r.pipe(s,{end:!0})}).listen(3e3);console.error(`${A("Serving at")} ${W("http://localhost:3000")}`),await e.wait,o.close()},Rt=ce;function Tt(){console.error(W("Usage:")),console.error("- esbuild-script start: start the devserver."),console.error("- esbuild-script build: generate production build."),console.error("- esbuild-script ssg: generate static site."),console.error("- esbuild-script ssg --no-js: generate static site without JS."),console.error("- esbuild-script help: display command line usages.")}async function ue(){let t=process.argv[2]||"";switch(t){case"init":return await xt(),!0;case"start":return await Rt(),!0;case"ssg":return Q(!0);case"build":return Q(!1);case"help":case"--help":return Tt(),!0;default:return console.error($(`Unknown command: '${t}'`)),Tt(),!1}}async function me(){try{await ue()||(process.exitCode=1)}catch(t){console.error($(t)),process.exitCode=1}}me();})();
