// @generated
/* eslint-disable */
// prettier-ignore
(() => {
var at=Object.create;var v=Object.defineProperty;var lt=Object.getOwnPropertyDescriptor;var ut=Object.getOwnPropertyNames;var pt=Object.getPrototypeOf,ct=Object.prototype.hasOwnProperty;var O=t=>v(t,"__esModule",{value:!0});var mt=(t,e)=>{O(t);for(var r in e)v(t,r,{get:e[r],enumerable:!0})},dt=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ut(e))!ct.call(t,s)&&s!=="default"&&v(t,s,{get:()=>e[s],enumerable:!(r=lt(e,s))||r.enumerable});return t},u=t=>dt(O(v(t!=null?at(pt(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);mt(exports,{default:()=>it});var h=u(require("fs/promises")),d=u(require("path")),I=u(require("esbuild"));var W=u(require("fs/promises")),C=u(require("path")),N=u(require("@mdx-js/mdx")),ht={name:"WebAppResolvePlugin",setup(t){t.onResolve({filter:/^data:/},()=>({external:!0}))}},B=/^esbuild-scripts-internal\/virtual\//,gt=(0,C.resolve)("."),ft=t=>({name:"VirtualPathResolvePlugin",setup(e){e.onResolve({filter:B},r=>({path:r.path,namespace:"virtual-path"})),e.onLoad({filter:B,namespace:"virtual-path"},r=>({contents:t[r.path],resolveDir:gt,loader:"jsx"}))}});async function Pt(t){return`import React from 'react';
import mdx from 'esbuild-scripts/__internal-components__/mdx';
${await(0,N.default)(t.trim().split(`
`).slice(1).join(`
`).trim())}
MDXContent.additionalProperties = typeof additionalProperties === 'undefined' ? undefined : additionalProperties;
`}var yt={name:"mdx",setup(t){t.onLoad({filter:/\.md$/},async e=>({contents:await Pt((await(0,W.readFile)(e.path)).toString()),loader:"jsx"}))}},bt=t=>[ht,ft(t),yt],U=bt;var St=({virtualPathMappings:t,isServer:e=!1,isProd:r=!1})=>({define:{__dirname:'""',__SERVER__:String(e),"process.env.NODE_ENV":r?'"production"':'"development"'},bundle:!0,minify:!1,legalComments:"linked",platform:"browser",target:"es2019",logLevel:"error",external:["path","fs"],plugins:U(t)}),y=St;var b=u(require("path")),jt=(0,b.join)(__dirname,"templates"),j=(0,b.join)("src","pages"),H=(0,b.join)("build","__ssr.jsx"),G=(0,b.join)("build","__ssr.css"),A="build",R="out",x="esbuild-scripts-internal/virtual/",w=`${x}__generated-entry-point__/`,T=`${w}__server__.jsx`;var X=u(require("fs/promises")),E=u(require("path"));var m=u(require("fs/promises")),f=u(require("path")),D=async(t,e)=>{await(0,m.mkdir)(e,{recursive:!0}),await Promise.all((await(0,m.readdir)(e)).map(r=>(0,m.rm)((0,f.join)(e,r),{recursive:!0,force:!0}))),await Promise.all((await(0,m.readdir)(t)).map(async r=>{let s=(0,f.join)(t,r),i=(0,f.join)(e,r);await J(s)?await D(s,i):await(0,m.copyFile)(s,i)}))},J=t=>(0,m.lstat)(t).then(e=>e.isDirectory()),Y=async t=>Promise.all((await(0,m.readdir)(t)).flatMap(async e=>{let r=(0,f.join)(t,e);return await J(r)?[r,...await Y(r)]:[r]})).then(e=>e.flat()),z=async t=>(await Y(t)).map(e=>(0,f.relative)(t,e)).sort((e,r)=>e.localeCompare(r));var q="// @generated",L=t=>t.endsWith("index")?t.substring(0,t.length-(t.endsWith("/index")?6:5)):t,K=(t,e,r)=>r?`${t}/src/pages/${e}`:`${x}${e}`,Q=(t,e,r,s,i)=>{let o=s.filter(l=>l!==e),n=i.filter(l=>l!==e),a=(l,c)=>K(t,l,c),g=[...o.map((l,c)=>`const RealComponent${c} = lazy(() => import('${a(l,!0)}'));`),...n.map((l,c)=>`const VirtualComponent${c} = lazy(() => import('${a(l,!1)}'));`)].join(`
`),p=a(e,r),P=[...o.map((l,c)=>`        <Route exact path="/${L(l)}"><Suspense fallback={null}><RealComponent${c} /></Suspense></Route>`),...n.map((l,c)=>`        <Route exact path="/${L(l)}"><Suspense fallback={null}><VirtualComponent${c} /></Suspense></Route>`)].join(`
`);return`${q}
import React,{Suspense,lazy} from 'react';
import {hydrate,render} from 'react-dom';
import {BrowserRouter,Route,Switch} from 'esbuild-scripts/__internal-components__/react-router';
import Document from '${t}/src/pages/_document';
import Page from '${p}';
${g}
const element = (
  <BrowserRouter>
    <Document>
      <Switch>
        <Route exact path="/${L(e)}"><Page /></Route>
${P}
      </Switch>
    </Document>
  </BrowserRouter>
);
const rootElement = document.getElementById('root');
if (rootElement.hasChildNodes()) hydrate(element, rootElement); else render(element, rootElement);
`},_t=(t,e,r)=>{let s=(n,a)=>K(t,n,a),i=[...e.map((n,a)=>`import RealPage${a} from '${s(n,!0)}';`),...r.map((n,a)=>`import VirtualPage${a} from '${s(n,!1)}';`)].join(`
`),o=[...e.map((n,a)=>`'${n}': RealPage${a}`),...r.map((n,a)=>`'${n}': VirtualPage${a}`)].join(", ");return`${q}
import React from 'react';
import {renderToString} from 'react-dom/server';
import Helmet from 'esbuild-scripts/components/Head';
import {StaticRouter} from 'esbuild-scripts/__internal-components__/react-router';
import Document from '${t}/src/pages/_document';
${i}
const map = { ${o} };
module.exports = (path) => ({
  divHTML: renderToString(
    <StaticRouter location={'/'+path}>
      <Document>{React.createElement(map[path])}</Document>
    </StaticRouter>
  ),
  noJS: map[path].noJS,
  helmet: Helmet.renderStatic(),
});
`},vt=async()=>(await(0,X.mkdir)(j,{recursive:!0}),(await z(j)).map(t=>{switch((0,E.extname)(t)){case".js":case".jsx":case".ts":case".tsx":break;default:return null}return t.substring(0,t.lastIndexOf("."))}).filter(t=>t!=null&&!t.startsWith("_document"))),S=t=>Object.fromEntries(Object.entries(t).map(([e,r])=>[`${x}${e}`,r])),$=async t=>{let e=(0,E.resolve)("."),r=await vt(),s=Object.fromEntries([...r.map(i=>[`${w}${i}.jsx`,Q(e,i,!0,r,t)]),...t.map(i=>[`${w}${i}.jsx`,Q(e,i,!1,r,t)])]);return s[T]=_t(e,r,t),{entryPointsWithoutExtension:r,entryPointVirtualFiles:s}};var Rt=(t,e)=>{let r=[],s=[];t.forEach(n=>{!e&&n.endsWith("js")?r.push(n):n.endsWith("css")&&s.push(n)});let i=s.map(n=>`<link rel="stylesheet" href="/${n}" />`).join("")+r.map(n=>`<link rel="modulepreload" href="/${n}" />`).join(""),o=r.map(n=>`<script type="module" src="/${n}"><\/script>`).join("");return{headLinks:i,bodyScriptLinks:o}},Z=(t,e)=>e==null?`<head>${t}</head>`:`<head>${[e.meta.toString(),e.title.toString(),e.link.toString(),e.script.toString(),t].join("")}</head>`,xt=(t,e)=>{let{headLinks:r,bodyScriptLinks:s}=Rt(e,t==null?void 0:t.noJS);if(t==null){let g=Z(r),p=`<body><div id="root"></div>${s}</body>`;return`<!DOCTYPE html><html>${g}${p}</html>`}let{divHTML:i,helmet:o}=t,n=Z(r,o),a=`<body><div id="root">${i}</div>${s}</body>`;return`<!DOCTYPE html><html ${o.htmlAttributes.toString()}>${n}${a}</html>`},V=xt;async function tt(t,e){let r={...t,...S(e)},{outputFiles:s}=await(0,I.build)({...y({virtualPathMappings:r,isProd:!0}),entryPoints:Object.keys(t),assetNames:"assets/[name]-[hash]",chunkNames:"chunks/[name]-[hash]",entryNames:"[dir]/[name]-[hash]",minify:!0,format:"esm",splitting:!0,write:!1,outdir:"build"}),i=(0,d.resolve)("build");return await Promise.all(s.map(async o=>{await(0,h.mkdir)((0,d.dirname)(o.path),{recursive:!0}),await(0,h.writeFile)(o.path,o.contents)})),s.map(({path:o})=>(0,d.relative)(i,o))}async function wt(t,e){await(0,I.build)({...y({virtualPathMappings:{...t,...S(e)},isServer:!0,isProd:!0}),entryPoints:[T],platform:"node",format:"cjs",legalComments:"none",outfile:H});try{return require((0,d.resolve)(H))}catch(r){return console.error("Unable to perform server side rendering since the server bundle is not correctly generated."),console.error(r),null}finally{await(0,h.unlink)(G)}}async function k(t,e){let r=new Date().getTime(),{entryPointsWithoutExtension:s,entryPointVirtualFiles:i}=await $(Object.keys(t));await D("public","build");let o,n;if(e){if([o,n]=await Promise.all([tt(i,t),wt(i,t)]),n==null)return!1}else o=await tt(i,t),n=null;let a=[...s,...Object.keys(t)].map(p=>{let P=o.filter(c=>c.startsWith("chunk")||c.startsWith(p)),l=V(n==null?void 0:n(p),P);return{entryPoint:p,html:l}});await Promise.all(a.map(async({entryPoint:p,html:P})=>{let l;p.endsWith("index")?l=(0,d.join)(A,`${p}.html`):l=(0,d.join)(A,p,"index.html"),await(0,h.mkdir)((0,d.dirname)(l),{recursive:!0}),await(0,h.writeFile)(l,P)}));let g=new Date().getTime()-r;return console.error(`\u26A1 Build success in ${g}ms.`),!0}var M=u(require("path")),et=u(require("esbuild")),_=u(require("express")),rt=u(require("express-ws"));function Tt(t){let e=r=>t.clients.forEach(async s=>s.send(JSON.stringify(r)));return{name:"devserver-websocket-reload",setup(r){let s=!1;t.on("connection",()=>e({building:!1,hasErrors:s})),r.onStart(()=>e({building:!0,hasErrors:s})),r.onEnd(i=>{s=i.errors.length>0,e({building:!1,hasErrors:s})})}}}var st=class{constructor(e,r){this.allEntryPointsWithoutExtension=e;this.expressDevServer=(0,_.default)();this.expressWebSocket=(0,rt.default)(this.expressDevServer);this.shutdownHandlers=[];this.shutdown=()=>this.shutdownHandlers.forEach(e=>e());this.expressDevServer.use(_.default.static(R)),this.expressDevServer.use(_.default.static("public")),this.expressDevServer.use(_.default.static((0,M.join)(__dirname,"devserver-js")));let s=this.expressWebSocket.getWss();(0,et.build)({...r,plugins:[...r.plugins||[],Tt(s)],assetNames:"assets/[name]-[hash]",chunkNames:"chunks/[name]-[hash]",entryNames:"[dir]/[name]-[hash]",splitting:!0,format:"esm",outdir:R,metafile:!0,watch:{onRebuild:(n,a)=>{a!=null&&this.handleBuildResult(a),n!=null&&console.error("[x] Rebuild Failed.")}}}).then(n=>{this.handleBuildResult(n)}),this.expressDevServer.get("*",async(n,a,g)=>{let p=this.files;if(p==null)return a.status(404).send("Unknown build status. Check again later.");if(this.getEntryPoint(n.path)==null)return g();let l=`${V(void 0,p)}
<script src="/dev-server-websocket.js"><\/script>
`;return a.send(l)}),this.expressWebSocket.app.ws("/_ws",()=>{});let i=this.expressDevServer.listen(3e3,()=>console.error(`Serving at http://localhost:3000
`)),o=[];i.on("connection",n=>{o.push(n),n.on("close",()=>{o=o.filter(a=>a!==n)})}),this.shutdownHandlers.push(()=>{s.clients.forEach(n=>n.close()),s.close(),o.forEach(n=>n.destroy()),i.close()})}handleBuildResult({metafile:e,warnings:r,errors:s,stop:i}){this.shutdownHandlers.push(()=>i==null?void 0:i()),this.files=e&&Object.keys(e.outputs).map(o=>(0,M.relative)(R,o)).filter(o=>!o.startsWith("__server__")),console.error(`[\u2713] Build finished with ${r.length} warnings, ${s.length} errors.`)}getEntryPoint(e){if(e==null||!e.startsWith("/"))return;let r=e.substring(1);return this.allEntryPointsWithoutExtension.find(s=>s.endsWith("index")?[s,s.substring(0,s.length-5)].includes(r):s===r)}};async function F(t){let{entryPointsWithoutExtension:e,entryPointVirtualFiles:r}=await $(Object.keys(t)),s={...r,...S(t)},i=[...e,...Object.keys(t)],o=new st(i,{...y({virtualPathMappings:s}),entryPoints:Object.keys(r),minify:!0});process.on("SIGINT",o.shutdown),process.on("SIGTERM",o.shutdown)}function nt(){console.error("Usage:"),console.error("- esbuild-script start: start the devserver."),console.error("- esbuild-script build: generate production build."),console.error("- esbuild-script ssg: generate static site."),console.error("- esbuild-script help: display command line usages.")}async function Et(t){let e=process.argv[2]||"";switch(e){case"start":return await F(t),!0;case"ssg":return k(t,!0);case"build":return k(t,!1);case"help":case"--help":return nt(),!0;default:return console.error(`Unknown command: '${e}'`),nt(),!1}}async function it(t){let e=t?await t():{};try{await Et(e)||(process.exitCode=1)}catch{process.exitCode=1}}0&&(module.exports={});
})();
//# sourceMappingURL=api.js.map
