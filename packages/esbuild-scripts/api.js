// @generated
/* eslint-disable */
// prettier-ignore
(() => {
var mt=Object.create;var R=Object.defineProperty;var gt=Object.getOwnPropertyDescriptor;var ht=Object.getOwnPropertyNames;var ft=Object.getPrototypeOf,Pt=Object.prototype.hasOwnProperty;var N=t=>R(t,"__esModule",{value:!0});var B=(t,e)=>{N(t);for(var r in e)R(t,r,{get:e[r],enumerable:!0})},bt=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ht(e))!Pt.call(t,n)&&n!=="default"&&R(t,n,{get:()=>e[n],enumerable:!(r=gt(e,n))||r.enumerable});return t},d=t=>bt(N(R(t!=null?mt(ft(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);B(exports,{constants:()=>C,default:()=>pt,utils:()=>Ct});var f=d(require("fs/promises")),g=d(require("path")),O=d(require("esbuild"));var L=d(require("fs/promises")),K=d(require("path"));var Y=d(require("@mdx-js/mdx")),z=d(require("remark-slug"));var U=({level:t,label:e})=>`${"#".repeat(t)} ${e}`,yt=t=>{let e=[],r=!1;return t.split(`
`).filter(o=>{if(o.startsWith("```"))r=!r;else return!r}).forEach(o=>{let a=o.trim();if(!a.startsWith("#"))return;let i=0;for(;a[i]==="#";)i+=1;if(i>6)throw new Error(`Invalid Header: '${a}'`);e.push({level:i,label:a.substring(i).trim()})}),e},G=t=>{let e=yt(t);if(e[0]==null)throw new Error("Lacking title.");if(e[0].level!==1)throw new Error(`First heading must be h1, found: ${U(e[0])}`);if(e.filter(r=>r.level===1).length>1)throw new Error("More than one h1.");return e},J=(t,e)=>{let r=t[e];if(r==null)throw new Error;let n=[],o=e+1;for(;o<t.length;){let{element:a,level:i,finishedIndex:s}=J(t,o);if(i<=r.level)break;if(i>r.level+1){let c=U({level:i,label:a.label});throw new Error(`Invalid header: ${c}. Expected Level: ${r.level+1}`)}o=s,n.push(a)}return{element:{label:r.label,children:n},level:r.level,finishedIndex:o}},wt=t=>{let e=G(t);return J(e,0).element},X=t=>{let e=G(t)[0];if(e==null)throw new Error;return e.label},$=wt;var St=async(t,e)=>{let r=t.trim().split(`
`).slice(1),n;if(e){let o=r.findIndex(a=>a.trimStart().startsWith("<!--")&&a.includes("truncate"));n=r.slice(0,o).join(`
`)}else n=r.join(`
`);return n=n.trim(),`import React from 'react';
import mdx from 'esbuild-scripts/__internal-components__/mdx';
${await(0,Y.default)(n,{remarkPlugins:[z.default]})}
MDXContent.truncated = ${e};
MDXContent.toc = ${JSON.stringify($(t),void 0,2)};
MDXContent.additionalProperties = typeof additionalProperties === 'undefined' ? undefined : additionalProperties;
`},b=St;var Tt={name:"WebAppResolvePlugin",setup(t){t.onResolve({filter:/^data:/},()=>({external:!0}))}},Q=/^esbuild-scripts-internal\/virtual\//,_t=(0,K.resolve)("."),xt=t=>({name:"VirtualPathResolvePlugin",setup(e){e.onResolve({filter:Q},r=>({path:r.path,namespace:"virtual-path"})),e.onLoad({filter:Q,namespace:"virtual-path"},r=>({contents:t[r.path],resolveDir:_t,loader:"jsx"}))}}),Rt={name:"mdx",setup(t){t.onLoad({filter:/\.md\?truncated=true$/},async e=>({contents:await b((await(0,L.readFile)(e.path.substring(0,e.path.lastIndexOf("?")))).toString(),!0),loader:"jsx"})),t.onLoad({filter:/\.md$/},async e=>({contents:await b((await(0,L.readFile)(e.path)).toString(),!1),loader:"jsx"}))}},$t=t=>[Tt,xt(t),Rt],Z=$t;var vt=({virtualPathMappings:t,isServer:e=!1,isProd:r=!1})=>({define:{__dirname:'""',__SERVER__:String(e),"process.env.NODE_ENV":r?'"production"':'"development"'},bundle:!0,minify:!1,legalComments:"linked",platform:"browser",target:"es2019",logLevel:"error",external:["path","fs"],plugins:Z(t)}),y=vt;var C={};B(C,{BUILD_PATH:()=>M,PAGES_PATH:()=>v,SSR_CSS_PATH:()=>I,SSR_JS_PATH:()=>E,TEMPLATE_PATH:()=>Et,VIRTUAL_GENERATED_ENTRY_POINT_PATH_PREFIX:()=>T,VIRTUAL_PATH_PREFIX:()=>S,VIRTUAL_SERVER_ENTRY_PATH:()=>_});var w=d(require("path")),Et=(0,w.join)(__dirname,"templates"),v=(0,w.join)("src","pages"),E=(0,w.join)("build","__ssr.jsx"),I=(0,w.join)("build","__ssr.css"),M="build",S="esbuild-scripts-internal/virtual/",T=`${S}__generated-entry-point__/`,_=`${T}__server__.jsx`;var rt=d(require("fs/promises")),k=d(require("path"));var m=d(require("fs/promises")),P=d(require("path")),D=async(t,e)=>{await(0,m.mkdir)(e,{recursive:!0}),await Promise.all((await(0,m.readdir)(e)).map(r=>(0,m.rm)((0,P.join)(e,r),{recursive:!0,force:!0}))),await Promise.all((await(0,m.readdir)(t)).map(async r=>{let n=(0,P.join)(t,r),o=(0,P.join)(e,r);await q(n)?await D(n,o):await(0,m.copyFile)(n,o)}))},q=t=>(0,m.lstat)(t).then(e=>e.isDirectory()),tt=async t=>Promise.all((await(0,m.readdir)(t)).flatMap(async e=>{let r=(0,P.join)(t,e);return await q(r)?[r,...await tt(r)]:[r]})).then(e=>e.flat()),et=async t=>(await tt(t)).map(e=>(0,P.relative)(t,e)).sort((e,r)=>e.localeCompare(r));var nt="// @generated",F=t=>t.endsWith("index")?t.substring(0,t.length-(t.endsWith("/index")?6:5)):t,ot=(t,e,r)=>r?`${t}/src/pages/${e}`:`${S}${e}`,it=(t,e,r,n,o)=>{let a=n.filter(l=>l!==e),i=o.filter(l=>l!==e),s=(l,u)=>ot(t,l,u),c=[...a.map((l,u)=>`const RealComponent${u} = lazy(() => import('${s(l,!0)}'));`),...i.map((l,u)=>`const VirtualComponent${u} = lazy(() => import('${s(l,!1)}'));`)].join(`
`),p=s(e,r),h=[...a.map((l,u)=>`        <Route exact path="/${F(l)}"><Suspense fallback={null}><RealComponent${u} /></Suspense></Route>`),...i.map((l,u)=>`        <Route exact path="/${F(l)}"><Suspense fallback={null}><VirtualComponent${u} /></Suspense></Route>`)].join(`
`);return`${nt}
import React,{Suspense,lazy} from 'react';
import {hydrate,render} from 'react-dom';
import {BrowserRouter,Route,Switch} from 'esbuild-scripts/__internal-components__/react-router';
import Document from '${t}/src/pages/_document';
import Page from '${p}';
${c}
const element = (
  <BrowserRouter>
    <Document>
      <Switch>
        <Route exact path="/${F(e)}"><Page /></Route>
${h}
      </Switch>
    </Document>
  </BrowserRouter>
);
const rootElement = document.getElementById('root');
if (rootElement.hasChildNodes()) hydrate(element, rootElement); else render(element, rootElement);
`},Mt=(t,e,r)=>{let n=(i,s)=>ot(t,i,s),o=[...e.map((i,s)=>`import RealPage${s} from '${n(i,!0)}';`),...r.map((i,s)=>`import VirtualPage${s} from '${n(i,!1)}';`)].join(`
`),a=[...e.map((i,s)=>`'${i}': RealPage${s}`),...r.map((i,s)=>`'${i}': VirtualPage${s}`)].join(", ");return`${nt}
import React from 'react';
import {renderToString} from 'react-dom/server';
import Helmet from 'esbuild-scripts/components/Head';
import {StaticRouter} from 'esbuild-scripts/__internal-components__/react-router';
import Document from '${t}/src/pages/_document';
${o}
const map = { ${a} };
module.exports = (path) => ({
  divHTML: renderToString(
    <StaticRouter location={'/'+path}>
      <Document>{React.createElement(map[path])}</Document>
    </StaticRouter>
  ),
  noJS: map[path].noJS,
  helmet: Helmet.renderStatic(),
});
`},kt=async()=>(await(0,rt.mkdir)(v,{recursive:!0}),(await et(v)).map(t=>{switch((0,k.extname)(t)){case".js":case".jsx":case".ts":case".tsx":break;default:return null}return t.substring(0,t.lastIndexOf("."))}).filter(t=>t!=null&&!t.startsWith("_document"))),x=t=>Object.fromEntries(Object.entries(t).map(([e,r])=>[`${S}${e}`,r])),H=async t=>{let e=(0,k.resolve)("."),r=await kt(),n=Object.fromEntries([...r.map(o=>[`${T}${o}.jsx`,it(e,o,!0,r,t)]),...t.map(o=>[`${T}${o}.jsx`,it(e,o,!1,r,t)])]);return n[_]=Mt(e,r,t),{entryPointsWithoutExtension:r,entryPointVirtualFiles:n}};var Ht=(t,e)=>e?`<script type="module" src="/${t}"><\/script>`:`<script src="/${t}"><\/script>`,Vt=(t,e)=>`<link rel="${e?"modulepreload":"preload"}" href="/${t}" />`,jt=(t,e,r)=>{let n=[],o=[];t.forEach(s=>{!r&&s.endsWith("js")?n.push(s):s.endsWith("css")&&o.push(s)});let a=o.map(s=>`<link rel="stylesheet" href="/${s}" />`).join("")+n.map(s=>Vt(s,e)).join(""),i=n.map(s=>Ht(s,e)).join("");return{headLinks:a,bodyScriptLinks:i}},st=(t,e)=>e==null?`<head>${t}</head>`:`<head>${[e.meta.toString(),e.title.toString(),e.link.toString(),e.script.toString(),t].join("")}</head>`,At=(t,e,r)=>{let{headLinks:n,bodyScriptLinks:o}=jt(e,r,t==null?void 0:t.noJS);if(t==null){let p=st(n),h=`<body><div id="root"></div>${o}</body>`;return`<!DOCTYPE html><html>${p}${h}</html>`}let{divHTML:a,helmet:i}=t,s=st(n,i),c=`<body><div id="root">${a}</div>${o}</body>`;return`<!DOCTYPE html><html ${i.htmlAttributes.toString()}>${s}${c}</html>`},V=At;async function at(t,e){let r={...t,...x(e)},{outputFiles:n}=await(0,O.build)({...y({virtualPathMappings:r,isProd:!0}),entryPoints:Object.keys(t),assetNames:"assets/[name]-[hash]",chunkNames:"chunks/[name]-[hash]",entryNames:"[dir]/[name]-[hash]",minify:!0,format:"esm",splitting:!0,write:!1,outdir:"build"}),o=(0,g.resolve)("build");return await Promise.all(n.map(async a=>{await(0,f.mkdir)((0,g.dirname)(a.path),{recursive:!0}),await(0,f.writeFile)(a.path,a.contents)})),n.map(({path:a})=>(0,g.relative)(o,a))}async function Lt(t,e){await(0,O.build)({...y({virtualPathMappings:{...t,...x(e)},isServer:!0,isProd:!0}),entryPoints:[_],platform:"node",format:"cjs",legalComments:"none",outfile:E});try{return require((0,g.resolve)(E))}catch(r){return console.error("Unable to perform server side rendering since the server bundle is not correctly generated."),console.error(r),null}finally{await(0,f.unlink)(I)}}async function j(t,e){let r=new Date().getTime(),{entryPointsWithoutExtension:n,entryPointVirtualFiles:o}=await H(Object.keys(t));await D("public","build");let a,i;if(e){if([a,i]=await Promise.all([at(o,t),Lt(o,t)]),i==null)return!1}else a=await at(o,t),i=null;let s=[...n,...Object.keys(t)].map(p=>{let h=a.filter(u=>u.startsWith("chunk")||u.startsWith(p)),l=V(i==null?void 0:i(p),h,!0);return{entryPoint:p,html:l}});await Promise.all(s.map(async({entryPoint:p,html:h})=>{let l;p.endsWith("index")?l=(0,g.join)(M,`${p}.html`):l=(0,g.join)(M,p,"index.html"),await(0,f.mkdir)((0,g.dirname)(l),{recursive:!0}),await(0,f.writeFile)(l,h)}));let c=new Date().getTime()-r;return console.error(`\u26A1 Build success in ${c}ms.`),!0}var A=d(require("http")),lt=d(require("esbuild"));function It(t,e){if(e==null||!e.startsWith("/"))return;let r=e.substring(1);return t.find(n=>n.endsWith("index")?[n,n.substring(0,n.length-5)].includes(r):n===r)}var ut=t=>V(void 0,[`${t}.js`,`${t}.css`],!1);async function W(t){let{entryPointsWithoutExtension:e,entryPointVirtualFiles:r}=await H(Object.keys(t)),n={...r,...x(t)},o=[...e,...Object.keys(t)],a=await(0,lt.serve)({servedir:"public",port:19815},{...y({virtualPathMappings:n}),entryPoints:Object.keys(r),sourcemap:"inline",outdir:"public"}),i=(0,A.createServer)((s,c)=>{let p=It(o,s.url);if(p!=null){c.writeHead(200,{"Content-Type":"text/html"}),c.end(ut(p));return}let h={hostname:a.host,port:a.port,path:s.url,method:s.method,headers:s.headers},l=(0,A.request)(h,u=>{if(u.statusCode===404){c.writeHead(200,{"Content-Type":"text/html"}),c.end(ut("index"));return}c.writeHead(u.statusCode||200,u.headers),u.pipe(c,{end:!0})});s.pipe(l,{end:!0})}).listen(3e3);console.error("Serving at http://localhost:3000"),await a.wait,i.close()}var Ct={parseMarkdownHeaderTree:$,parseMarkdownTitle:X,compileMarkdownToReact:b};function ct(){console.error("Usage:"),console.error("- esbuild-script start: start the devserver."),console.error("- esbuild-script build: generate production build."),console.error("- esbuild-script ssg: generate static site."),console.error("- esbuild-script help: display command line usages.")}async function Dt(t){let e=process.argv[2]||"";switch(e){case"start":return await W(t),!0;case"ssg":return j(t,!0);case"build":return j(t,!1);case"help":case"--help":return ct(),!0;default:return console.error(`Unknown command: '${e}'`),ct(),!1}}async function pt(t){let e=t?await t():{};try{await Dt(e)||(process.exitCode=1)}catch{process.exitCode=1}}0&&(module.exports={constants,utils});
})();
//# sourceMappingURL=api.js.map
