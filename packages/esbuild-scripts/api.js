// @generated
/* eslint-disable */
// prettier-ignore
(() => {
var it=Object.create;var _=Object.defineProperty;var at=Object.getOwnPropertyDescriptor;var lt=Object.getOwnPropertyNames;var ut=Object.getPrototypeOf,pt=Object.prototype.hasOwnProperty;var F=t=>_(t,"__esModule",{value:!0});var ct=(t,e)=>{F(t);for(var r in e)_(t,r,{get:e[r],enumerable:!0})},mt=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of lt(e))!pt.call(t,n)&&n!=="default"&&_(t,n,{get:()=>e[n],enumerable:!(r=at(e,n))||r.enumerable});return t},u=t=>mt(F(_(t!=null?it(ut(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);ct(exports,{default:()=>st});var h=u(require("fs/promises")),d=u(require("path")),L=u(require("esbuild"));var O=u(require("fs/promises")),B=u(require("path")),C=u(require("@mdx-js/mdx")),dt={name:"WebAppResolvePlugin",setup(t){t.onResolve({filter:/^data:/},()=>({external:!0}))}},N=/^esbuild-scripts-internal\/virtual\//,ht=(0,B.resolve)("."),gt=t=>({name:"VirtualPathResolvePlugin",setup(e){e.onResolve({filter:N},r=>({path:r.path,namespace:"virtual-path"})),e.onLoad({filter:N,namespace:"virtual-path"},r=>({contents:t[r.path],resolveDir:ht,loader:"jsx"}))}});async function ft(t){return`import React from 'react';
import mdx from 'esbuild-scripts/__internal-components__/mdx';
${await(0,C.default)(t.trim().split(`
`).slice(1).join(`
`).trim())}
MDXContent.additionalProperties = typeof additionalProperties === 'undefined' ? undefined : additionalProperties;
`}var Pt={name:"mdx",setup(t){t.onLoad({filter:/\.md$/},async e=>({contents:await ft((await(0,O.readFile)(e.path)).toString()),loader:"jsx"}))}},yt=t=>[dt,gt(t),Pt],W=yt;var bt=({virtualPathMappings:t,isServer:e=!1,isProd:r=!1})=>({define:{__dirname:'""',__SERVER__:String(e),"process.env.NODE_ENV":r?'"production"':'"development"'},bundle:!0,minify:!1,legalComments:"linked",platform:"browser",target:"es2019",logLevel:"error",external:["path","fs"],plugins:W(t)}),y=bt;var b=u(require("path")),Mt=(0,b.join)(__dirname,"templates"),H=(0,b.join)("src","pages"),j=(0,b.join)("build","__ssr.jsx"),U=(0,b.join)("build","__ssr.css"),A="build",x="out",R="esbuild-scripts-internal/virtual/",v=`${R}__generated-entry-point__/`,T=`${v}__server__.jsx`;var z=u(require("fs/promises")),w=u(require("path"));var c=u(require("fs/promises")),g=u(require("path")),D=async(t,e)=>{await(0,c.mkdir)(e,{recursive:!0}),await Promise.all((await(0,c.readdir)(e)).map(r=>(0,c.rm)((0,g.join)(e,r),{recursive:!0,force:!0}))),await Promise.all((await(0,c.readdir)(t)).map(async r=>{let n=(0,g.join)(t,r),s=(0,g.join)(e,r);await G(n)?await D(n,s):await(0,c.copyFile)(n,s)}))},G=t=>(0,c.lstat)(t).then(e=>e.isDirectory()),Y=async t=>Promise.all((await(0,c.readdir)(t)).flatMap(async e=>{let r=(0,g.join)(t,e);return await G(r)?[r,...await Y(r)]:[r]})).then(e=>e.flat()),J=async t=>(await Y(t)).map(e=>(0,g.relative)(t,e)).sort((e,r)=>e.localeCompare(r));var X="// @generated",k=t=>t.endsWith("index")?t.substring(0,t.length-(t.endsWith("/index")?6:5)):t,q=(t,e,r)=>r?`${t}/src/pages/${e}`:`${R}${e}`,K=(t,e,r,n,s)=>{let i=n.filter(l=>l!==e),o=s.filter(l=>l!==e),a=(l,p)=>q(t,l,p),f=[...i.map((l,p)=>`const RealComponent${p} = lazy(() => import('${a(l,!0)}'));`),...o.map((l,p)=>`const VirtualComponent${p} = lazy(() => import('${a(l,!1)}'));`)].join(`
`),m=a(e,r),P=[...i.map((l,p)=>`        <Route exact path="/${k(l)}"><Suspense fallback={null}><RealComponent${p} /></Suspense></Route>`),...o.map((l,p)=>`        <Route exact path="/${k(l)}"><Suspense fallback={null}><VirtualComponent${p} /></Suspense></Route>`)].join(`
`);return`${X}
import React,{Suspense,lazy} from 'react';
import {hydrate,render} from 'react-dom';
import {BrowserRouter,Route,Switch} from 'esbuild-scripts/__internal-components__/react-router';
import Document from '${t}/src/pages/_document';
import Page from '${m}';
${f}
const element = (
  <BrowserRouter>
    <Document>
      <Switch>
        <Route exact path="/${k(e)}"><Page /></Route>
${P}
      </Switch>
    </Document>
  </BrowserRouter>
);
const rootElement = document.getElementById('root');
if (rootElement.hasChildNodes()) hydrate(element, rootElement); else render(element, rootElement);
`},St=(t,e,r)=>{let n=(o,a)=>q(t,o,a),s=[...e.map((o,a)=>`import RealPage${a} from '${n(o,!0)}';`),...r.map((o,a)=>`import VirtualPage${a} from '${n(o,!1)}';`)].join(`
`),i=[...e.map((o,a)=>`'${o}': RealPage${a}`),...r.map((o,a)=>`'${o}': VirtualPage${a}`)].join(", ");return`${X}
import React from 'react';
import {renderToString} from 'react-dom/server';
import Helmet from 'esbuild-scripts/components/Head';
import {StaticRouter} from 'esbuild-scripts/__internal-components__/react-router';
import Document from '${t}/src/pages/_document';
${s}
const map = { ${i} };
module.exports = (path) => ({
  divHTML: renderToString(
    <StaticRouter location={'/'+path}>
      <Document>{React.createElement(map[path])}</Document>
    </StaticRouter>
  ),
  noJS: map[path].noJS,
  helmet: Helmet.renderStatic(),
});
`},_t=async()=>(await(0,z.mkdir)(H,{recursive:!0}),(await J(H)).map(t=>{switch((0,w.extname)(t)){case".js":case".jsx":case".ts":case".tsx":break;default:return null}return t.substring(0,t.lastIndexOf("."))}).filter(t=>t!=null&&!t.startsWith("_document"))),S=t=>Object.fromEntries(Object.entries(t).map(([e,r])=>[`${R}${e}`,r])),E=async t=>{let e=(0,w.resolve)("."),r=await _t(),n=Object.fromEntries([...r.map(s=>[`${v}${s}.jsx`,K(e,s,!0,r,t)]),...t.map(s=>[`${v}${s}.jsx`,K(e,s,!1,r,t)])]);return n[T]=St(e,r,t),{entryPointsWithoutExtension:r,entryPointVirtualFiles:n}};var xt=(t,e)=>{let r=[],n=[];t.forEach(o=>{!e&&o.endsWith("js")?r.push(o):o.endsWith("css")&&n.push(o)});let s=n.map(o=>`<link rel="stylesheet" href="/${o}" />`).join("")+r.map(o=>`<link rel="modulepreload" href="/${o}" />`).join(""),i=r.map(o=>`<script type="module" src="/${o}"><\/script>`).join("");return{headLinks:s,bodyScriptLinks:i}},Q=(t,e)=>e==null?`<head>${t}</head>`:`<head>${[e.meta.toString(),e.title.toString(),e.link.toString(),e.script.toString(),t].join("")}</head>`,Rt=(t,e)=>{let{headLinks:r,bodyScriptLinks:n}=xt(e,t==null?void 0:t.noJS);if(t==null){let f=Q(r),m=`<body><div id="root"></div>${n}</body>`;return`<!DOCTYPE html><html>${f}${m}</html>`}let{divHTML:s,helmet:i}=t,o=Q(r,i),a=`<body><div id="root">${s}</div>${n}</body>`;return`<!DOCTYPE html><html ${i.htmlAttributes.toString()}>${o}${a}</html>`},$=Rt;async function Z(t,e){let r={...t,...S(e)},{outputFiles:n}=await(0,L.build)({...y({virtualPathMappings:r,isProd:!0}),entryPoints:Object.keys(t),assetNames:"assets/[name]-[hash]",chunkNames:"chunks/[name]-[hash]",entryNames:"[dir]/[name]-[hash]",minify:!0,format:"esm",splitting:!0,write:!1,outdir:"build"}),s=(0,d.resolve)("build");return await Promise.all(n.map(async i=>{await(0,h.mkdir)((0,d.dirname)(i.path),{recursive:!0}),await(0,h.writeFile)(i.path,i.contents)})),n.map(({path:i})=>(0,d.relative)(s,i))}async function vt(t,e){await(0,L.build)({...y({virtualPathMappings:{...t,...S(e)},isServer:!0,isProd:!0}),entryPoints:[T],platform:"node",format:"cjs",legalComments:"none",outfile:j});try{return require((0,d.resolve)(j))}catch(r){return console.error("Unable to perform server side rendering since the server bundle is not correctly generated."),console.error(r),null}finally{await(0,h.unlink)(U)}}async function V(t,e){let r=new Date().getTime(),{entryPointsWithoutExtension:n,entryPointVirtualFiles:s}=await E(Object.keys(t));await D("public","build");let i,o;if(e){if([i,o]=await Promise.all([Z(s,t),vt(s,t)]),o==null)return!1}else i=await Z(s,t),o=null;let a=[...n,...Object.keys(t)].map(m=>{let P=i.filter(p=>p.startsWith("chunk")||p.startsWith(m)),l=$(o==null?void 0:o(m),P);return{entryPoint:m,html:l}});await Promise.all(a.map(async({entryPoint:m,html:P})=>{let l;m.endsWith("index")?l=(0,d.join)(A,`${m}.html`):l=(0,d.join)(A,m,"index.html"),await(0,h.mkdir)((0,d.dirname)(l),{recursive:!0}),await(0,h.writeFile)(l,P)}));let f=new Date().getTime()-r;return console.error(`\u26A1 Build success in ${f}ms.`),!0}var tt=u(require("path")),et=u(require("esbuild")),M=u(require("express"));var rt=class{constructor(e,r){this.allEntryPointsWithoutExtension=e;this.expressDevServer=(0,M.default)();this.shutdownHandlers=[];this.shutdown=()=>this.shutdownHandlers.forEach(e=>e());this.expressDevServer.use(M.default.static(x)),this.expressDevServer.use(M.default.static("public")),(0,et.build)({...r,assetNames:"assets/[name]-[hash]",chunkNames:"chunks/[name]-[hash]",entryNames:"[dir]/[name]-[hash]",splitting:!0,format:"esm",outdir:x,metafile:!0,watch:{onRebuild:(s,i)=>{i!=null&&this.handleBuildResult(i),s!=null&&console.error("[x] Rebuild Failed.")}}}).then(s=>{this.shutdownHandlers.push(()=>{var i;return(i=s.stop)==null?void 0:i.call(s)}),this.handleBuildResult(s)}),this.expressDevServer.get("*",async(s,i,o)=>{let a=this.files;return a==null?i.status(404).send("Unknown build status. Check again later."):this.getEntryPoint(s.path)==null?o():i.send($(void 0,a))});let n=this.expressDevServer.listen(3e3,()=>console.error("Serving at http://localhost:3000"));this.shutdownHandlers.push(()=>n.close())}handleBuildResult({metafile:e,warnings:r,errors:n}){this.files=e&&Object.keys(e.outputs).map(s=>(0,tt.relative)(x,s)).filter(s=>!s.startsWith("__server__")),console.error(`[\u2713] Build finished with ${r.length} warnings, ${n.length} errors.`)}getEntryPoint(e){if(e==null||!e.startsWith("/"))return;let r=e.substring(1);return this.allEntryPointsWithoutExtension.find(n=>n.endsWith("index")?[n,n.substring(0,n.length-5)].includes(r):n===r)}};async function I(t){let{entryPointsWithoutExtension:e,entryPointVirtualFiles:r}=await E(Object.keys(t)),n={...r,...S(t)},s=[...e,...Object.keys(t)],i=new rt(s,{...y({virtualPathMappings:n}),entryPoints:Object.keys(r),minify:!0});process.on("SIGINT",i.shutdown),process.on("SIGTERM",i.shutdown)}function nt(){console.error("Usage:"),console.error("- esbuild-script start: start the devserver."),console.error("- esbuild-script build: generate production build."),console.error("- esbuild-script ssg: generate static site."),console.error("- esbuild-script help: display command line usages.")}async function Tt(t){let e=process.argv[2]||"";switch(e){case"start":return await I(t),!0;case"ssg":return V(t,!0);case"build":return V(t,!1);case"help":case"--help":return nt(),!0;default:return console.error(`Unknown command: '${e}'`),nt(),!1}}async function st(t){let e=t?await t():{};try{await Tt(e)||(process.exitCode=1)}catch{process.exitCode=1}}0&&(module.exports={});
})();
//# sourceMappingURL=api.js.map
