#!/usr/bin/env node
/* eslint-disable */
// prettier-ignore
(()=>{var O=Object.create,w=Object.defineProperty,z=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty,V=Object.getOwnPropertyNames,q=Object.getOwnPropertyDescriptor;var K=e=>w(e,"__esModule",{value:!0});var Q=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of V(t))!G.call(e,r)&&r!=="default"&&w(e,r,{get:()=>t[r],enumerable:!(n=q(t,r))||n.enumerable});return e},s=e=>Q(K(w(e!=null?O(z(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var M=s(require("path")),A=s(require("esbuild")),o=s(require("fs-extra"));var c=s(require("path")),g=(0,c.join)(__dirname,"client.js"),B=(0,c.join)(__dirname,"server.js"),h=(0,c.join)("build","ssr.js"),H=(0,c.join)("build","ssr.css"),x=(0,c.join)("build","index.html"),b=(0,c.join)("build","app.js"),R=(0,c.join)("build","app.css");var P=s(require("path")),N=s(require("@yarnpkg/esbuild-plugin-pnp")),D=s(require("esbuild-plugin-sass")),X={name:"WebAppResolvePlugin",setup(e){e.onResolve({filter:/data:/},()=>({external:!0})),e.onResolve({filter:/USER_DEFINED_APP_ENTRY_POINT/},()=>({path:(0,P.resolve)((0,P.join)("src","App.tsx"))}))}},Z=[X,(0,D.default)(),(0,N.pnpPlugin)()],j=Z;var ee=({isServer:e=!1,isProd:t=!1})=>({define:{__SERVER__:String(e),"process.env.NODE_ENV":t?'"production"':'"development"'},bundle:!0,minify:!1,target:"es2019",logLevel:"error",plugins:j}),u=ee;var I=s(require("crypto")),U=s(require("html-minifier")),d=s(require("node-html-parser")),te=e=>(0,I.createHash)("md5").update(e).digest().toString("hex").substring(0,8),re=(e,t,...n)=>{let r=(0,d.parse)(e),i=r.querySelector("head"),l=r.querySelector("body");return r.querySelector("#root").innerHTML=t,n.forEach(({type:v,originalFilename:S,content:p})=>{let C=p==null?`/${S}`:`/${S}?h=${te(p)}`;v==="js"?(l.appendChild((0,d.parse)(`<script src="${C}"></script>`)),i.appendChild((0,d.parse)(`<link rel="preload" href="${C}" as="script" />`))):i.appendChild((0,d.parse)(`<link rel="stylesheet" href="${C}" />`))}),(0,U.minify)(r.toString(),{minifyCSS:!1,minifyJS:!1,collapseWhitespace:!0,collapseInlineTagWhitespace:!0})},y=re;var m=e=>process.stderr.isTTY?t=>`[${e}m${t}[0m`:t=>t,f=m(31),T=m(32),Y=m(33),a=m(34),he=m(35),be=m(36);var oe=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],ie=e=>{let t=0,n=new Date().getTime();return setInterval(()=>{let r=`${((new Date().getTime()-n)/1e3).toFixed(1)}s`,i=e(r),l=oe[t%10];process.stderr.write(Y(`${i} ${l}\r`)),t+=1},process.stderr.isTTY?40:1e3)},E=ie;async function ne(){return await(0,A.build)({...u({isProd:!0}),entryPoints:[g],minify:!0,outfile:b}),Promise.all([(0,o.stat)(b),(0,o.stat)(R)])}async function se(){await(0,A.build)({...u({isServer:!0,isProd:!0}),entryPoints:[B],platform:"node",format:"cjs",outfile:h});try{return require((0,M.resolve)(h))}catch{return console.error(f("Unable to perform server side rendering since the server bundle is not correctly generated.")),null}finally{await Promise.all([(0,o.remove)(h),(0,o.remove)(H)])}}async function le(e){let[t,n,r]=await Promise.all([(0,o.readFile)(x),(0,o.readFile)(b),(0,o.readFile)(R)]),i=y(t.toString(),e,{type:"js",originalFilename:"app.js",content:n.toString()},{type:"css",originalFilename:"app.css",content:r.toString()});await(0,o.writeFile)(x,i)}async function L(){await(0,o.ensureDir)("build"),await(0,o.emptyDir)("build"),await(0,o.copy)("public","build");let e=E(()=>"[i] Bundling..."),t=new Date().getTime(),[[n,r],i]=await Promise.all([ne(),se()]);if(clearInterval(e),i==null)return!1;await le(i);let l=new Date().getTime()-t;return console.error(T(`Build success in ${l}ms.`)),console.error(a(`Minified JS Size: ${Math.ceil(n.size/1024)}k.`)),console.error(a(`Minified CSS Size: ${Math.ceil(r.size/1024)}k.`)),!0}var _=s(require("http")),F=s(require("path")),W=s(require("esbuild")),J=s(require("fs-extra"));async function $(){let e=E(i=>`[i] Starting dev server (${i})...`),t=y((await(0,J.readFile)((0,F.join)("public","index.html"))).toString(),"",{type:"js",originalFilename:"app.js"},{type:"css",originalFilename:"app.css"}),n=await(0,W.serve)({servedir:"public",port:19815},{...u({}),entryPoints:[g],sourcemap:"inline",outfile:(0,F.join)("public","app.js")});clearInterval(e),console.error(a(`[i] ESBuild Server started on http://${n.host}:${n.port}.`));let r=(0,_.createServer)((i,l)=>{if(i.url==="/"){l.writeHead(200,{"Content-Type":"text/html"}),l.end(t);return}let v={hostname:n.host,port:n.port,path:i.url,method:i.method,headers:i.headers},S=(0,_.request)(v,p=>{if(p.statusCode===404){l.writeHead(200,{"Content-Type":"text/html"}),l.end(t);return}l.writeHead(p.statusCode||200,p.headers),p.pipe(l,{end:!0})});i.pipe(S,{end:!0})}).listen(3e3);console.error(a("[i] Proxy Server started.")),console.error(`${T("Serving at")} ${a("http://localhost:3000")}`),await n.wait,r.close()}function k(){console.error(a("Usage:")),console.error("- esbuild start: start the devserver."),console.error("- esbuild build: generate production build."),console.error("- esbuild help: display command line usages.")}async function ae(e){switch(e){case"start":return await $(),!0;case"build":return L();case"help":case"--help":return k(),!0;default:return console.error(f(`Unknown command: '${e}'`)),k(),!1}}async function ce(){try{await ae(process.argv[2]||"")||(process.exitCode=1)}catch(e){console.error(f(e)),process.exitCode=1}}ce();})();
