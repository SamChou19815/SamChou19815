#!/usr/bin/env node
/* eslint-disable */
// prettier-ignore
(()=>{var I=Object.create,_=Object.defineProperty,U=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty,M=Object.getOwnPropertyNames,J=Object.getOwnPropertyDescriptor;var O=e=>_(e,"__esModule",{value:!0});var k=(e,r,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of M(r))!Y.call(e,s)&&s!=="default"&&_(e,s,{get:()=>r[s],enumerable:!(t=J(r,s))||t.enumerable});return e},i=e=>k(O(_(e!=null?I(U(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var A=i(require("crypto")),N=i(require("path")),P=i(require("esbuild")),o=i(require("fs-extra"));var n=i(require("path")),d=(0,n.join)(__dirname,"client.js"),R=(0,n.join)(__dirname,"server.js"),f=(0,n.join)("build","ssr.js"),x=(0,n.join)("build","ssr.css"),E=(0,n.join)("build","index.html"),S=(0,n.join)("build","app.js"),T=(0,n.join)("build","app.css");var b=i(require("path")),y=i(require("@yarnpkg/esbuild-plugin-pnp")),z=({isServer:e=!1,isProd:r=!1})=>({define:{__SERVER__:String(e),"process.env.NODE_ENV":r?'"production"':'"development"'},bundle:!0,minify:!1,target:"es2017",logLevel:"error",plugins:[{name:"EntryPointResolvePlugin",setup(t){t.onResolve({filter:/USER_DEFINED_APP_ENTRY_POINT/},()=>({path:(0,b.resolve)((0,b.join)("src","App.tsx"))}))}},(0,y.pnpPlugin)()]}),m=z;var c=e=>process.stderr.isTTY?r=>`[${e}m${r}[0m`:r=>r,u=c(31),g=c(32),L=c(33),l=c(34),re=c(35),oe=c(36);var G=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],V=e=>{let r=0,t=new Date().getTime();return setInterval(()=>{let s=`${((new Date().getTime()-t)/1e3).toFixed(1)}s`,p=e(s),a=G[r%10];process.stderr.write(L(`${p} ${a}\r`)),r+=1},process.stderr.isTTY?40:1e3)},w=V;async function W(e){let[r,t,s]=await Promise.all([(0,o.readFile)(E),(0,o.readFile)(S),(0,o.readFile)(T)]),p=r.toString(),a=F=>(0,A.createHash)("md5").update(F).digest().toString("hex").substring(0,8),C=a(t),D=a(s),$=p.replace('href="/app.css"',`href="/app.css?h=${D}"`).replace('"/app.js"',`"/app.js?h=${C}"`).replace('"/app.js"',`"/app.js?h=${C}"`).replace('<div id="root"></div>',`<div id="root">${e}</div>`);await(0,o.writeFile)(E,$)}async function h(){let e=w(()=>"[i] Bundling..."),r=new Date().getTime();await Promise.all([(0,P.build)({...m({isProd:!0}),entryPoints:[d],minify:!0,outfile:S}),(0,P.build)({...m({isServer:!0,isProd:!0}),entryPoints:[R],platform:"node",format:"cjs",outfile:f})]),clearInterval(e);let t;try{t=require((0,N.resolve)(f))}catch{return console.error(u("Unable to perform server side rendering since the server bundle is not correctly generated.")),t="",!1}finally{await Promise.all([(0,o.remove)(f),(0,o.remove)(x)])}await(0,o.copy)("public","build");let[,s,p]=await Promise.all([W(t),(0,o.stat)(S),(0,o.stat)(T)]),a=new Date().getTime()-r;return console.error(g(`Build success in ${a}ms.`)),console.error(l(`Minified JS Size: ${Math.ceil(s.size/1024)}k.`)),console.error(l(`Minified CSS Size: ${Math.ceil(p.size/1024)}k.`)),!0}var B=i(require("path")),H=i(require("esbuild"));async function v(){let e=await(0,H.serve)({servedir:"public",host:"127.0.0.1",port:3e3},{...m({}),entryPoints:[d],sourcemap:"inline",outfile:(0,B.join)("public","app.js")});console.error(g("Server started.")),console.error(`Serving at ${l(`http://${e.host}:${e.port}`)}`),await e.wait}function j(){console.error(l("Usage:")),console.error("- esbuild start: start the devserver."),console.error("- esbuild build: generate production build."),console.error("- esbuild help: display command line usages.")}async function q(e){switch(e){case"start":return await v(),!0;case"build":return h();case"help":case"--help":return j(),!0;default:return console.error(u(`Unknown command: '${e}'`)),j(),!1}}async function K(){try{await q(process.argv[2]||"")||(process.exitCode=1)}catch(e){console.error(u(e)),process.exitCode=1}}K();})();
