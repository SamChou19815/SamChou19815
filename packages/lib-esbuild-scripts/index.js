#!/usr/bin/env node
/* eslint-disable */
// prettier-ignore
(()=>{var J=Object.create,x=Object.defineProperty,O=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty,z=Object.getOwnPropertyNames,G=Object.getOwnPropertyDescriptor;var V=e=>x(e,"__esModule",{value:!0});var q=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of z(t))!k.call(e,o)&&o!=="default"&&x(e,o,{get:()=>t[o],enumerable:!(r=G(t,o))||r.enumerable});return e},s=e=>q(V(x(e!=null?J(O(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var U=s(require("path")),R=s(require("esbuild")),i=s(require("fs-extra"));var c=s(require("path")),h=(0,c.join)(__dirname,"client.js"),N=(0,c.join)(__dirname,"server.js"),g=(0,c.join)("build","ssr.js"),$=(0,c.join)("build","ssr.css"),w=(0,c.join)("build","index.html"),b=(0,c.join)("build","app.js"),A=(0,c.join)("build","app.css");var T=s(require("path")),B=s(require("@yarnpkg/esbuild-plugin-pnp")),K=({isServer:e=!1,isProd:t=!1})=>({define:{__SERVER__:String(e),"process.env.NODE_ENV":t?'"production"':'"development"',__THEME_SWITCH__:String(!process.env.NO_THEME_SWITCH)},bundle:!0,minify:!1,target:"es2017",logLevel:"error",plugins:[{name:"WebAppResolvePlugin",setup(r){r.onResolve({filter:/data:/},()=>({external:!0})),r.onResolve({filter:/USER_DEFINED_APP_ENTRY_POINT/},()=>({path:(0,T.resolve)((0,T.join)("src","App.tsx"))}))}},(0,B.pnpPlugin)()]}),d=K;var I=s(require("crypto")),j=s(require("html-minifier")),u=s(require("node-html-parser")),Q=e=>(0,I.createHash)("md5").update(e).digest().toString("hex").substring(0,8),X=(e,t,...r)=>{let o=(0,u.parse)(e),n=o.querySelector("head"),l=o.querySelector("body");return o.querySelector("#root").innerHTML=t,r.forEach(({type:v,originalFilename:S,content:p})=>{let C=p==null?`/${S}`:`/${S}?h=${Q(p)}`;v==="js"?(l.appendChild((0,u.parse)(`<script src="${C}"></script>`)),n.appendChild((0,u.parse)(`<link rel="preload" href="${C}" as="script" />`))):n.appendChild((0,u.parse)(`<link rel="stylesheet" href="${C}" />`))}),(0,j.minify)(o.toString(),{minifyCSS:!1,minifyJS:!1,collapseWhitespace:!0,collapseInlineTagWhitespace:!0})},_=X;var m=e=>process.stderr.isTTY?t=>`[${e}m${t}[0m`:t=>t,f=m(31),E=m(32),D=m(33),a=m(34),pe=m(35),me=m(36);var Z=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],ee=e=>{let t=0,r=new Date().getTime();return setInterval(()=>{let o=`${((new Date().getTime()-r)/1e3).toFixed(1)}s`,n=e(o),l=Z[t%10];process.stderr.write(D(`${n} ${l}\r`)),t+=1},process.stderr.isTTY?40:1e3)},y=ee;async function te(){return await(0,R.build)({...d({isProd:!0}),entryPoints:[h],minify:!0,outfile:b}),Promise.all([(0,i.stat)(b),(0,i.stat)(A)])}async function re(){await(0,R.build)({...d({isServer:!0,isProd:!0}),entryPoints:[N],platform:"node",format:"cjs",outfile:g});let e;try{e=require((0,U.resolve)(g))}catch{return console.error(f("Unable to perform server side rendering since the server bundle is not correctly generated.")),!1}finally{await Promise.all([(0,i.remove)(g),(0,i.remove)($)])}let[t,r,o]=await Promise.all([(0,i.readFile)(w),(0,i.readFile)(b),(0,i.readFile)(A)]),n=_(t.toString(),e,{type:"js",originalFilename:"app.js",content:r.toString()},{type:"css",originalFilename:"app.css",content:o.toString()});return await(0,i.writeFile)(w,n),!0}async function H(){await(0,i.emptyDir)("build"),await(0,i.copy)("public","build");let e=y(()=>"[i] Bundling..."),t=new Date().getTime(),[[r,o],n]=await Promise.all([te(),re()]);if(clearInterval(e),!n)return!1;let l=new Date().getTime()-t;return console.error(E(`Build success in ${l}ms.`)),console.error(a(`Minified JS Size: ${Math.ceil(r.size/1024)}k.`)),console.error(a(`Minified CSS Size: ${Math.ceil(o.size/1024)}k.`)),!0}var P=s(require("http")),L=s(require("path")),M=s(require("esbuild")),Y=s(require("fs-extra"));async function F(){let e=y(n=>`[i] Starting dev server (${n})...`),t=_((await(0,Y.readFile)((0,L.join)("public","index.html"))).toString(),"",{type:"js",originalFilename:"app.js"},{type:"css",originalFilename:"app.css"}),r=await(0,M.serve)({servedir:"public",port:19815},{...d({}),entryPoints:[h],sourcemap:"inline",outfile:(0,L.join)("public","app.js")});clearInterval(e),console.error(a(`[i] ESBuild Server started on http://${r.host}:${r.port}.`));let o=(0,P.createServer)((n,l)=>{if(n.url==="/"){l.writeHead(200,{"Content-Type":"text/html"}),l.end(t);return}let v={hostname:r.host,port:r.port,path:n.url,method:n.method,headers:n.headers},S=(0,P.request)(v,p=>{if(p.statusCode===404){l.writeHead(200,{"Content-Type":"text/html"}),l.end(t);return}l.writeHead(p.statusCode||200,p.headers),p.pipe(l,{end:!0})});n.pipe(S,{end:!0})}).listen(3e3);console.error(a("[i] Proxy Server started.")),console.error(`${E("Serving at")} ${a("http://localhost:3000")}`),await r.wait,o.close()}function W(){console.error(a("Usage:")),console.error("- esbuild start: start the devserver."),console.error("- esbuild build: generate production build."),console.error("- esbuild help: display command line usages.")}async function oe(e){switch(e){case"start":return await F(),!0;case"build":return H();case"help":case"--help":return W(),!0;default:return console.error(f(`Unknown command: '${e}'`)),W(),!1}}async function ne(){try{await oe(process.argv[2]||"")||(process.exitCode=1)}catch(e){console.error(f(e)),process.exitCode=1}}ne();})();
