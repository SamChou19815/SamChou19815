#!/usr/bin/env node
/* eslint-disable */
// prettier-ignore
(()=>{var J=Object.create,T=Object.defineProperty,k=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty,V=Object.getOwnPropertyNames,q=Object.getOwnPropertyDescriptor;var z=e=>T(e,"__esModule",{value:!0});var K=(e,t,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of V(t))!G.call(e,r)&&r!=="default"&&T(e,r,{get:()=>t[r],enumerable:!(s=q(t,r))||s.enumerable});return e},n=e=>K(z(T(e!=null?J(k(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var Y=n(require("path")),x=n(require("esbuild")),o=n(require("fs-extra"));var l=n(require("path")),f=(0,l.join)(__dirname,"client.js"),F=(0,l.join)(__dirname,"server.js"),h=(0,l.join)("build","ssr.js"),H=(0,l.join)("build","ssr.css"),C=(0,l.join)("build","index.html"),v=(0,l.join)("build","app.js"),B=(0,l.join)("build","app.css");var S=n(require("path")),N=n(require("@yarnpkg/esbuild-plugin-pnp")),j=n(require("esbuild-plugin-sass")),Q={name:"WebAppResolvePlugin",setup(e){e.onResolve({filter:/data:/},()=>({external:!0})),e.onResolve({filter:/USER_DEFINED_APP_ENTRY_POINT/},()=>({path:(0,S.resolve)((0,S.join)("src","App.tsx"))}))}},X=[Q,(0,j.default)(),(0,N.pnpPlugin)()],D=X;var Z=({isServer:e=!1,isProd:t=!1})=>({define:{__SERVER__:String(e),"process.env.NODE_ENV":t?'"production"':'"development"'},bundle:!0,minify:!1,target:"es2019",logLevel:"info",plugins:D}),u=Z;var $=n(require("crypto")),U=n(require("html-minifier")),m=n(require("node-html-parser")),ee=e=>(0,$.createHash)("md5").update(e).digest().toString("hex").substring(0,8),te=(e,t,...s)=>{let r=(0,m.parse)(e),i=r.querySelector("head"),E=r.querySelector("body");return r.querySelector("#root").innerHTML=t,s.forEach(({type:P,originalFilename:a,content:L})=>{let _=L==null?`/${a}`:`/${a}?h=${ee(L)}`;P==="js"?(E.appendChild((0,m.parse)(`<script src="${_}"></script>`)),i.appendChild((0,m.parse)(`<link rel="preload" href="${_}" as="script" />`))):i.appendChild((0,m.parse)(`<link rel="stylesheet" href="${_}" />`))}),(0,U.minify)(r.toString(),{minifyCSS:!1,minifyJS:!1,collapseWhitespace:!0,collapseInlineTagWhitespace:!0})},g=te;var c=e=>process.stderr.isTTY?t=>`[${e}m${t}[0m`:t=>t,d=c(31),b=c(32),I=c(33),p=c(34),fe=c(35),he=c(36);async function re(){await(0,x.build)({...u({isProd:!0}),entryPoints:[f],minify:!0,outfile:v})}async function oe(){await(0,x.build)({...u({isServer:!0,isProd:!0}),entryPoints:[F],platform:"node",format:"cjs",logLevel:"error",outfile:h});try{return require((0,Y.resolve)(h))}catch{return console.error(d("Unable to perform server side rendering since the server bundle is not correctly generated.")),null}finally{await Promise.all([(0,o.remove)(h),(0,o.remove)(H)])}}async function ne(e){let[t,s,r]=await Promise.all([(0,o.readFile)(C),(0,o.readFile)(v),(0,o.readFile)(B)]),i=g(t.toString(),e,{type:"js",originalFilename:"app.js",content:s.toString()},{type:"css",originalFilename:"app.css",content:r.toString()});await(0,o.writeFile)(C,i)}async function w(){console.error(I("[i] Bundling...")),await(0,o.ensureDir)("build"),await(0,o.emptyDir)("build"),await(0,o.copy)("public","build");let e=new Date().getTime(),[,t]=await Promise.all([re(),oe()]);if(t==null)return!1;await ne(t);let s=new Date().getTime()-e;return console.error(`\u26A1 ${b(`Build success in ${s}ms.`)}`),!0}var y=n(require("http")),R=n(require("path")),W=n(require("esbuild")),M=n(require("fs-extra"));async function A(){let e=g((await(0,M.readFile)((0,R.join)("public","index.html"))).toString(),"",{type:"js",originalFilename:"app.js"},{type:"css",originalFilename:"app.css"}),t=await(0,W.serve)({servedir:"public",port:19815},{...u({}),entryPoints:[f],sourcemap:"inline",outfile:(0,R.join)("public","app.js")});console.error(p(`[i] ESBuild Server started on http://${t.host}:${t.port}.`));let s=(0,y.createServer)((r,i)=>{if(r.url==="/"){i.writeHead(200,{"Content-Type":"text/html"}),i.end(e);return}let E={hostname:t.host,port:t.port,path:r.url,method:r.method,headers:r.headers},P=(0,y.request)(E,a=>{if(a.statusCode===404){i.writeHead(200,{"Content-Type":"text/html"}),i.end(e);return}i.writeHead(a.statusCode||200,a.headers),a.pipe(i,{end:!0})});r.pipe(P,{end:!0})}).listen(3e3);console.error(p("[i] Proxy Server started.")),console.error(`${b("Serving at")} ${p("http://localhost:3000")}`),await t.wait,s.close()}function O(){console.error(p("Usage:")),console.error("- esbuild start: start the devserver."),console.error("- esbuild build: generate production build."),console.error("- esbuild help: display command line usages.")}async function ie(e){switch(e){case"start":return await A(),!0;case"build":return w();case"help":case"--help":return O(),!0;default:return console.error(d(`Unknown command: '${e}'`)),O(),!1}}async function se(){try{await ie(process.argv[2]||"")||(process.exitCode=1)}catch(e){console.error(d(e)),process.exitCode=1}}se();})();
