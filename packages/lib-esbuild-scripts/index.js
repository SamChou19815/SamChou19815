#!/usr/bin/env node
/* eslint-disable */
// prettier-ignore
(()=>{var U=Object.create,E=Object.defineProperty,Y=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty,J=Object.getOwnPropertyNames,O=Object.getOwnPropertyDescriptor;var k=e=>E(e,"__esModule",{value:!0});var z=(e,o,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of J(o))!M.call(e,t)&&t!=="default"&&E(e,t,{get:()=>o[t],enumerable:!(r=O(o,t))||r.enumerable});return e},i=e=>z(k(E(e!=null?U(Y(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var B=i(require("crypto")),H=i(require("path")),v=i(require("esbuild")),s=i(require("fs-extra"));var a=i(require("path")),f=(0,a.join)(__dirname,"client.js"),R=(0,a.join)(__dirname,"server.js"),S=(0,a.join)("build","ssr.js"),y=(0,a.join)("build","ssr.css"),T=(0,a.join)("build","index.html"),h=(0,a.join)("build","app.js"),P=(0,a.join)("build","app.css");var b=i(require("path")),L=i(require("@yarnpkg/esbuild-plugin-pnp")),G=({isServer:e=!1,isProd:o=!1})=>({define:{__SERVER__:String(e),"process.env.NODE_ENV":o?'"production"':'"development"'},bundle:!0,minify:!1,target:"es2017",logLevel:"error",plugins:[{name:"EntryPointResolvePlugin",setup(r){r.onResolve({filter:/USER_DEFINED_APP_ENTRY_POINT/},()=>({path:(0,b.resolve)((0,b.join)("src","App.tsx"))}))}},(0,L.pnpPlugin)()]}),u=G;var d=e=>process.stderr.isTTY?o=>`[${e}m${o}[0m`:o=>o,m=d(31),g=d(32),w=d(33),n=d(34),re=d(35),te=d(36);var V=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],W=e=>{let o=0,r=new Date().getTime();return setInterval(()=>{let t=`${((new Date().getTime()-r)/1e3).toFixed(1)}s`,c=e(t),l=V[o%10];process.stderr.write(w(`${c} ${l}\r`)),o+=1},process.stderr.isTTY?40:1e3)},A=W;async function q(e){let[o,r,t]=await Promise.all([(0,s.readFile)(T),(0,s.readFile)(h),(0,s.readFile)(P)]),c=o.toString(),l=I=>(0,B.createHash)("md5").update(I).digest().toString("hex").substring(0,8),p=l(r),D=l(t),F=c.replace('href="/app.css"',`href="/app.css?h=${D}"`).replace('"/app.js"',`"/app.js?h=${p}"`).replace('"/app.js"',`"/app.js?h=${p}"`).replace('<div id="root"></div>',`<div id="root">${e}</div>`);await(0,s.writeFile)(T,F)}async function C(){let e=A(()=>"[i] Bundling..."),o=new Date().getTime();await Promise.all([(0,v.build)({...u({isProd:!0}),entryPoints:[f],minify:!0,outfile:h}),(0,v.build)({...u({isServer:!0,isProd:!0}),entryPoints:[R],platform:"node",format:"cjs",outfile:S})]),clearInterval(e);let r;try{r=require((0,H.resolve)(S))}catch{return console.error(m("Unable to perform server side rendering since the server bundle is not correctly generated.")),r="",!1}finally{await Promise.all([(0,s.remove)(S),(0,s.remove)(y)])}await(0,s.copy)("public","build");let[,t,c]=await Promise.all([q(r),(0,s.stat)(h),(0,s.stat)(P)]),l=new Date().getTime()-o;return console.error(g(`Build success in ${l}ms.`)),console.error(n(`Minified JS Size: ${Math.ceil(t.size/1024)}k.`)),console.error(n(`Minified CSS Size: ${Math.ceil(c.size/1024)}k.`)),!0}var _=i(require("http")),N=i(require("path")),$=i(require("esbuild"));async function x(){let e=await(0,$.serve)({servedir:"public",port:3456},{...u({}),entryPoints:[f],sourcemap:"inline",outfile:(0,N.join)("public","app.js")});console.error(n(`[i] ESBuild Server started on http://${e.host}:${e.port}.`));let o=(0,_.createServer)((r,t)=>{let c={hostname:e.host,port:e.port,path:r.url,method:r.method,headers:r.headers},l=(0,_.request)(c,p=>{if(p.statusCode===404){t.writeHead(404,{"Content-Type":"text/html"}),t.end("<h1>404</h1>");return}t.writeHead(p.statusCode||200,p.headers),p.pipe(t,{end:!0})});r.pipe(l,{end:!0})}).listen(3e3);console.error(n("[i] Proxy Server started.")),console.error(`${g("Serving at")} ${n("http://localhost:3000")}`),await e.wait,o.close()}function j(){console.error(n("Usage:")),console.error("- esbuild start: start the devserver."),console.error("- esbuild build: generate production build."),console.error("- esbuild help: display command line usages.")}async function K(e){switch(e){case"start":return await x(),!0;case"build":return C();case"help":case"--help":return j(),!0;default:return console.error(m(`Unknown command: '${e}'`)),j(),!1}}async function Q(){try{await K(process.argv[2]||"")||(process.exitCode=1)}catch(e){console.error(m(e)),process.exitCode=1}}Q();})();
