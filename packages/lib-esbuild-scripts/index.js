#!/usr/bin/env node
/* eslint-disable */
// prettier-ignore
(()=>{var J=Object.create,w=Object.defineProperty,k=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty,z=Object.getOwnPropertyNames,G=Object.getOwnPropertyDescriptor;var V=e=>w(e,"__esModule",{value:!0});var q=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of z(t))!O.call(e,o)&&o!=="default"&&w(e,o,{get:()=>t[o],enumerable:!(r=G(t,o))||r.enumerable});return e},s=e=>q(V(w(e!=null?J(k(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var U=s(require("path")),A=s(require("esbuild")),n=s(require("fs-extra"));var c=s(require("path")),h=(0,c.join)(__dirname,"client.js"),B=(0,c.join)(__dirname,"server.js"),g=(0,c.join)("build","ssr.js"),H=(0,c.join)("build","ssr.css"),x=(0,c.join)("build","index.html"),b=(0,c.join)("build","app.js"),R=(0,c.join)("build","app.css");var y=s(require("path")),N=s(require("@yarnpkg/esbuild-plugin-pnp")),K=({isServer:e=!1,isProd:t=!1})=>({define:{__SERVER__:String(e),"process.env.NODE_ENV":t?'"production"':'"development"'},bundle:!0,minify:!1,target:"es2019",logLevel:"error",plugins:[{name:"WebAppResolvePlugin",setup(r){r.onResolve({filter:/data:/},()=>({external:!0})),r.onResolve({filter:/USER_DEFINED_APP_ENTRY_POINT/},()=>({path:(0,y.resolve)((0,y.join)("src","App.tsx"))}))}},(0,N.pnpPlugin)()]}),d=K;var D=s(require("crypto")),j=s(require("html-minifier")),u=s(require("node-html-parser")),Q=e=>(0,D.createHash)("md5").update(e).digest().toString("hex").substring(0,8),X=(e,t,...r)=>{let o=(0,u.parse)(e),i=o.querySelector("head"),l=o.querySelector("body");return o.querySelector("#root").innerHTML=t,r.forEach(({type:v,originalFilename:S,content:p})=>{let C=p==null?`/${S}`:`/${S}?h=${Q(p)}`;v==="js"?(l.appendChild((0,u.parse)(`<script src="${C}"></script>`)),i.appendChild((0,u.parse)(`<link rel="preload" href="${C}" as="script" />`))):i.appendChild((0,u.parse)(`<link rel="stylesheet" href="${C}" />`))}),(0,j.minify)(o.toString(),{minifyCSS:!1,minifyJS:!1,collapseWhitespace:!0,collapseInlineTagWhitespace:!0})},T=X;var m=e=>process.stderr.isTTY?t=>`[${e}m${t}[0m`:t=>t,f=m(31),E=m(32),I=m(33),a=m(34),me=m(35),de=m(36);var Z=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],ee=e=>{let t=0,r=new Date().getTime();return setInterval(()=>{let o=`${((new Date().getTime()-r)/1e3).toFixed(1)}s`,i=e(o),l=Z[t%10];process.stderr.write(I(`${i} ${l}\r`)),t+=1},process.stderr.isTTY?40:1e3)},P=ee;async function te(){return await(0,A.build)({...d({isProd:!0}),entryPoints:[h],minify:!0,outfile:b}),Promise.all([(0,n.stat)(b),(0,n.stat)(R)])}async function re(){await(0,A.build)({...d({isServer:!0,isProd:!0}),entryPoints:[B],platform:"node",format:"cjs",outfile:g});try{return require((0,U.resolve)(g))}catch{return console.error(f("Unable to perform server side rendering since the server bundle is not correctly generated.")),null}finally{await Promise.all([(0,n.remove)(g),(0,n.remove)(H)])}}async function oe(e){let[t,r,o]=await Promise.all([(0,n.readFile)(x),(0,n.readFile)(b),(0,n.readFile)(R)]),i=T(t.toString(),e,{type:"js",originalFilename:"app.js",content:r.toString()},{type:"css",originalFilename:"app.css",content:o.toString()});await(0,n.writeFile)(x,i)}async function L(){await(0,n.ensureDir)("build"),await(0,n.emptyDir)("build"),await(0,n.copy)("public","build");let e=P(()=>"[i] Bundling..."),t=new Date().getTime(),[[r,o],i]=await Promise.all([te(),re()]);if(clearInterval(e),i==null)return!1;await oe(i);let l=new Date().getTime()-t;return console.error(E(`Build success in ${l}ms.`)),console.error(a(`Minified JS Size: ${Math.ceil(r.size/1024)}k.`)),console.error(a(`Minified CSS Size: ${Math.ceil(o.size/1024)}k.`)),!0}var _=s(require("http")),F=s(require("path")),Y=s(require("esbuild")),M=s(require("fs-extra"));async function $(){let e=P(i=>`[i] Starting dev server (${i})...`),t=T((await(0,M.readFile)((0,F.join)("public","index.html"))).toString(),"",{type:"js",originalFilename:"app.js"},{type:"css",originalFilename:"app.css"}),r=await(0,Y.serve)({servedir:"public",port:19815},{...d({}),entryPoints:[h],sourcemap:"inline",outfile:(0,F.join)("public","app.js")});clearInterval(e),console.error(a(`[i] ESBuild Server started on http://${r.host}:${r.port}.`));let o=(0,_.createServer)((i,l)=>{if(i.url==="/"){l.writeHead(200,{"Content-Type":"text/html"}),l.end(t);return}let v={hostname:r.host,port:r.port,path:i.url,method:i.method,headers:i.headers},S=(0,_.request)(v,p=>{if(p.statusCode===404){l.writeHead(200,{"Content-Type":"text/html"}),l.end(t);return}l.writeHead(p.statusCode||200,p.headers),p.pipe(l,{end:!0})});i.pipe(S,{end:!0})}).listen(3e3);console.error(a("[i] Proxy Server started.")),console.error(`${E("Serving at")} ${a("http://localhost:3000")}`),await r.wait,o.close()}function W(){console.error(a("Usage:")),console.error("- esbuild start: start the devserver."),console.error("- esbuild build: generate production build."),console.error("- esbuild help: display command line usages.")}async function ne(e){switch(e){case"start":return await $(),!0;case"build":return L();case"help":case"--help":return W(),!0;default:return console.error(f(`Unknown command: '${e}'`)),W(),!1}}async function ie(){try{await ne(process.argv[2]||"")||(process.exitCode=1)}catch(e){console.error(f(e)),process.exitCode=1}}ie();})();
