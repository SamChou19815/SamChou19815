#!/bin/bash

echo "Installing tools necessary for deployments."
yarn install
yarn workspace sam-highlighter build

function deploy-firebase-frontend() {
    WORKSPACE="${1}-frontend"
    echo "Prepare deployment of ${WORKSPACE}..."
    yarn workspace ${WORKSPACE} build && \
      ./main-site-frontend/node_modules/.bin/firebase deploy \
      --token=$FIREBASE_TOKEN --non-interactive --only hosting:${1} && \
      echo "${1}-frontend has been deployed."
}

function deploy-blog() {
    git config --global user.name "SamChou19815"
    git config --global user.email "sam@developersam.com"
    GIT_USER=$DEPLOY_GH_PAGE_TOKEN yarn workspace blog deploy
}

deploy-firebase-frontend 'main-site'
deploy-firebase-frontend 'samlang-demo'
deploy-firebase-frontend 'ten-web'
deploy-blog
