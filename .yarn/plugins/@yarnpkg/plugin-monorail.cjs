// @generated
/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-monorail",
factory: function (require) {
var plugin=(()=>{var B=Object.create;var u=Object.defineProperty,H=Object.defineProperties,M=Object.getOwnPropertyDescriptor,q=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,g=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var E=(n,e,r)=>e in n?u(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,Y=(n,e)=>{for(var r in e||(e={}))k.call(e,r)&&E(n,r,e[r]);if(g)for(var r of g(e))x.call(e,r)&&E(n,r,e[r]);return n},F=(n,e)=>H(n,q(e)),T=n=>u(n,"__esModule",{value:!0});var l=n=>{if(typeof require!="undefined")return require(n);throw new Error('Dynamic require of "'+n+'" is not supported')};var I=(n,e)=>{var r={};for(var o in n)k.call(n,o)&&e.indexOf(o)<0&&(r[o]=n[o]);if(n!=null&&g)for(var o of g(n))e.indexOf(o)<0&&x.call(n,o)&&(r[o]=n[o]);return r};var z=(n,e)=>{T(n);for(var r in e)u(n,r,{get:e[r],enumerable:!0})},K=(n,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of U(e))!k.call(n,o)&&o!=="default"&&u(n,o,{get:()=>e[o],enumerable:!(r=M(e,o))||r.enumerable});return n},d=n=>K(T(u(n!=null?B(V(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var an={};z(an,{default:()=>sn});var N=d(l("fs")),S=d(l("clipanion"));var y=d(l("child_process")),$=d(l("fs")),h=d(l("path"));var m=n=>process.stderr.isTTY?e=>`[${n}m${e}[0m`:e=>e,b=m(31),P=m(32),J=m(33),L=m(34),R=m(35),pn=m(36);var X=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"];async function C(n,e){if(!process.stderr.isTTY)return e();let r=0,o=new Date().getTime(),i=setInterval(()=>{let a=`${((new Date().getTime()-o)/1e3).toFixed(1)}s`,s=n(a),c=X[r%10];process.stderr.write(J(`${s} ${c}\r`)),r+=1},process.stderr.isTTY?40:1e3),t=await e();return clearInterval(i),t}var Z=n=>{let e=(r,o)=>{let i=(0,y.spawnSync)("git",["diff",r,...o?[o]:[],"--name-only","--",n]).stdout.toString().trim();return i===""?[]:i.split(`
`)};return process.env.CI?e("HEAD^","HEAD"):e("origin/main")},Q=n=>JSON.parse((0,$.readFileSync)(n).toString()),nn=(n,e)=>{var i,t;let r=a=>{var s,c;return(0,h.dirname)(a)!==(0,h.join)((c=(s=n.information[e])==null?void 0:s.workspaceLocation)!=null?c:".","bin")};return((t=(i=n.information[e])==null?void 0:i.dependencyChain)!=null?t:[]).some(a=>{var p,f;let s=(f=(p=n.information[a])==null?void 0:p.workspaceLocation)!=null?f:".";return Z(s).some(r)})},en=n=>n.topologicallyOrdered.map(e=>{let r=nn(n,e);return[e,r]}).filter(([,e])=>e).map(([e])=>e),rn=async()=>{let n=Q("workspaces.json"),e=en(n);e.forEach(t=>{console.error(L(`[i] \`${t}\` needs to be recompiled.`))});let r=await C(t=>`[?] Compiling (${t})`,()=>Promise.all(e.map(t=>{let a=(0,y.spawn)("yarn",["workspace",t,"compile"],{shell:!0,stdio:["ignore","pipe","ignore"]}),s="";return a.stdout.on("data",c=>{s+=c.toString()}),new Promise(c=>{a.on("exit",p=>c([t,p===0,s]))})}))),o=r.map(t=>t[2]).join(""),i=r.filter(t=>!t[1]).map(t=>t[0]);return i.length===0?(console.error(P("[\u2713] All workspaces have been successfully compiled!")),!0):(console.error(R("[!] Compilation finished with some errors.")),console.error(o.trim()),i.forEach(t=>{console.error(b(`[x] \`${t}\` failed to exit with 0.`))}),!1)},j=rn;var A=d(l("fs"));function D(n){return n.scope==null?n.name:`@${n.scope}/${n.name}`}function on(n){let e=new Map;return n.workspaces.forEach(r=>{let o=r.relativeCwd;if(o===".")return;let i=D(r.locator),t=Array.from(r.getRecursiveWorkspaceDependencies()).map(a=>D(a.locator));e.set(i,{workspaceLocation:o,dependencies:t})}),e}function v(n,e){let r=[],o=[],i=new Set,t=new Set;function a(s){var p;if(t.has(s)){if(!i.has(s))return;o.push(s);let f=o.indexOf(s),G=o.slice(f,o.length).join(" -> ");throw new Error(`Cyclic dependency detected: ${G}`)}let c=(p=n.get(s))==null?void 0:p.dependencies;if(c==null)throw new Error(`Workspace ${e} is not found!`);t.add(s),o.push(s),i.add(s),c.forEach(a),i.delete(s),o.pop(),r.push(s)}return a(e),r}function O(n){let e=on(n);return{__type__:"@generated",information:Object.fromEntries(Array.from(e.entries()).map(t=>{var[r,a]=t,s=a,{dependencies:o}=s,i=I(s,["dependencies"]);return[r,F(Y({},i),{dependencyChain:v(e,r)})]}).sort(([r],[o])=>r.localeCompare(o))),topologicallyOrdered:(()=>{let r=[],o=new Set;return Array.from(e.keys()).forEach(i=>{v(e,i).forEach(a=>{o.has(a)||(r.push(a),o.add(a))})}),r})()}}function _(){return new Promise((n,e)=>(0,A.readFile)("workspaces.json",(r,o)=>r?e(r):n(JSON.parse(o.toString()))))}var w=class extends S.Command{async execute(){return await j()?0:1}};w.paths=[["c"]];var W=class extends S.Command{async execute(){try{let e=await _();return this.context.stdout.write(`${JSON.stringify(e,void 0,2)}
`),0}catch{return 1}}};W.paths=[["q"],["query"]];var tn={hooks:{afterAllInstalled(n){(0,N.writeFileSync)("workspaces.json",`${JSON.stringify(O(n),void 0,2)}
`)}},commands:[w,W]},sn=tn;return an;})();
return plugin;
}
};
